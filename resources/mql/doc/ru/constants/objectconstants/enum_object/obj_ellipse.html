<h1>OBJ_ELLIPSE</h1> 
<p><span>Эллипс.</span></p> 
<p style="text-align: center;"><img alt="ObjEllipse" width="580" height="371" style="margin:0px auto 0px auto;width:580px;height:371px;border:none" src="https://c.mql4.com/i/docs/ru/objellipse.png"></p> 
<p><span>Пример</span></p> 
<p><span>Следующий скрипт создает и перемещает на графике эллипс. Для создания и изменения свойств графического объекта написаны специальные функции, которые вы можете использовать "как есть" в своих собственных программах.</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr style="text-align:left;vertical-align:top;"> 
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">strict</span><br> <span style="color: #808080;">//---&nbsp;описание</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">description</span><span>&nbsp;</span><span style="color: #008080;">"Скрипт&nbsp;строит&nbsp;эллипс&nbsp;на&nbsp;графике."</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">description</span><span>&nbsp;</span><span style="color: #008080;">"Координаты&nbsp;точек&nbsp;привязки&nbsp;задаются"</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">description</span><span>&nbsp;</span><span style="color: #008080;">"в&nbsp;процентах&nbsp;от&nbsp;размеров&nbsp;окна&nbsp;графика."</span><br> <span style="color: #808080;">//---&nbsp;покажем&nbsp;окно&nbsp;входных&nbsp;параметров&nbsp;при&nbsp;запуске&nbsp;скрипта</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">script_show_inputs</span><br> <span style="color: #808080;">//---&nbsp;входные&nbsp;параметры&nbsp;скрипта</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpName=</span><span style="color: #008080;">"Ellipse"</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Имя&nbsp;эллипса</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpDate1=30;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Дата&nbsp;1-ой&nbsp;точки&nbsp;в&nbsp;%</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpPrice1=20;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Цена&nbsp;1-ой&nbsp;точки&nbsp;в&nbsp;%</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpDate2=70;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Дата&nbsp;2-ой&nbsp;точки&nbsp;в&nbsp;%</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpPrice2=80;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Цена&nbsp;2-ой&nbsp;точки&nbsp;в&nbsp;%</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpEllipseScale=0.2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Соотношение&nbsp;между&nbsp;временной&nbsp;и&nbsp;ценовой&nbsp;шкалами</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">color</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpColor=</span><span style="color: #0000ff;">clrRed</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Цвет&nbsp;эллипса</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">ENUM_LINE_STYLE</span><span>&nbsp;InpStyle=</span><span style="color: #0000ff;">STYLE_DASHDOTDOT</span><span>;&nbsp;</span><span style="color: #808080;">//&nbsp;Стиль&nbsp;линий&nbsp;эллипса</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpWidth=1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Толщина&nbsp;линий&nbsp;эллипса</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">bool</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpFill=</span><span style="color: #0000ff;">false</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Заливка&nbsp;эллипса&nbsp;цветом</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">bool</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpBack=</span><span style="color: #0000ff;">false</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Эллипс&nbsp;на&nbsp;заднем&nbsp;плане</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">bool</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpSelection=</span><span style="color: #0000ff;">true</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Выделить&nbsp;для&nbsp;перемещений</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">bool</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpHidden=</span><span style="color: #0000ff;">true</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Скрыт&nbsp;в&nbsp;списке&nbsp;объектов</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">long</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpZOrder=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Приоритет&nbsp;на&nbsp;нажатие&nbsp;мышью</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Cоздает&nbsp;эллипс&nbsp;по&nbsp;заданным&nbsp;координатам&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">bool</span><span>&nbsp;EllipseCreate(</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">long</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chart_ID=0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;ID&nbsp;графика</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=</span><span style="color: #008080;">"Ellipse"</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;имя&nbsp;эллипса</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_window=0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;номер&nbsp;подокна&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time1=0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;время&nbsp;первой&nbsp;точки</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price1=0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;цена&nbsp;первой&nbsp;точки</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time2=0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;время&nbsp;второй&nbsp;точки</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price2=0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;цена&nbsp;второй&nbsp;точки</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ellipse_scale=0,&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;соотношение&nbsp;между&nbsp;временной&nbsp;и&nbsp;ценовой&nbsp;шкалами&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">color</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clr=</span><span style="color: #0000ff;">clrRed</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;цвет&nbsp;эллипса</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">ENUM_LINE_STYLE</span><span>&nbsp;style=</span><span style="color: #0000ff;">STYLE_SOLID</span><span>,&nbsp;</span><span style="color: #808080;">//&nbsp;стиль&nbsp;линий&nbsp;эллипса</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width=1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;толщина&nbsp;линий&nbsp;эллипса</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">bool</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fill=</span><span style="color: #0000ff;">false</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;заливка&nbsp;эллипса&nbsp;цветом</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">bool</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;back=</span><span style="color: #0000ff;">false</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;на&nbsp;заднем&nbsp;плане</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">bool</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selection=</span><span style="color: #0000ff;">true</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;выделить&nbsp;для&nbsp;перемещений</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">bool</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hidden=</span><span style="color: #0000ff;">true</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;скрыт&nbsp;в&nbsp;списке&nbsp;объектов</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">long</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z_order=0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;приоритет&nbsp;на&nbsp;нажатие&nbsp;мышью</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---&nbsp;установим&nbsp;координаты&nbsp;точек&nbsp;привязки,&nbsp;если&nbsp;они&nbsp;не&nbsp;заданы</span><br> <span>&nbsp;&nbsp;&nbsp;ChangeEllipseEmptyPoints(time1,price1,time2,price2);</span><br> <span style="color: #808080;">//---&nbsp;сбросим&nbsp;значение&nbsp;ошибки</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ResetLastError</span><span>();</span><br> <span style="color: #808080;">//---&nbsp;создадим&nbsp;эллипс&nbsp;по&nbsp;заданным&nbsp;координатам</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!</span><span style="color: #0000ff;">ObjectCreate</span><span>(chart_ID,name,</span><span style="color: #0000ff;">OBJ_ELLIPSE</span><span>,sub_window,time1,price1,time2,price2))</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #0000ff;">__FUNCTION__</span><span>,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008080;">":&nbsp;не&nbsp;удалось&nbsp;создать&nbsp;эллипс!&nbsp;Код&nbsp;ошибки&nbsp;=&nbsp;"</span><span>,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">false</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;установим&nbsp;соотношение&nbsp;между&nbsp;временной&nbsp;и&nbsp;ценовой&nbsp;шкалами&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ObjectSetDouble</span><span>(chart_ID,name,</span><span style="color: #0000ff;">OBJPROP_SCALE</span><span>,InpEllipseScale);</span><br> <span style="color: #808080;">//---&nbsp;установим&nbsp;цвет&nbsp;эллипса</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ObjectSetInteger</span><span>(chart_ID,name,</span><span style="color: #0000ff;">OBJPROP_COLOR</span><span>,clr);</span><br> <span style="color: #808080;">//---&nbsp;установим&nbsp;стиль&nbsp;линий&nbsp;эллипса</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ObjectSetInteger</span><span>(chart_ID,name,</span><span style="color: #0000ff;">OBJPROP_STYLE</span><span>,style);</span><br> <span style="color: #808080;">//---&nbsp;установим&nbsp;толщину&nbsp;линий&nbsp;эллипса</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ObjectSetInteger</span><span>(chart_ID,name,</span><span style="color: #0000ff;">OBJPROP_WIDTH</span><span>,width);</span><br> <span style="color: #808080;">//---&nbsp;отобразим&nbsp;на&nbsp;переднем&nbsp;(false)&nbsp;или&nbsp;заднем&nbsp;(true)&nbsp;плане</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ObjectSetInteger</span><span>(chart_ID,name,</span><span style="color: #0000ff;">OBJPROP_BACK</span><span>,back);</span><br> <span style="color: #808080;">//---&nbsp;включим&nbsp;(true)&nbsp;или&nbsp;отключим&nbsp;(false)&nbsp;режим&nbsp;выделения&nbsp;эллипса&nbsp;для&nbsp;перемещений</span><br> <span style="color: #808080;">//---&nbsp;при&nbsp;создании&nbsp;графического&nbsp;объекта&nbsp;функцией&nbsp;ObjectCreate,&nbsp;по&nbsp;умолчанию&nbsp;объект</span><br> <span style="color: #808080;">//---&nbsp;нельзя&nbsp;выделить&nbsp;и&nbsp;перемещать.&nbsp;Внутри&nbsp;же&nbsp;этого&nbsp;метода&nbsp;параметр&nbsp;selection</span><br> <span style="color: #808080;">//---&nbsp;по&nbsp;умолчанию&nbsp;равен&nbsp;true,&nbsp;что&nbsp;позволяет&nbsp;выделять&nbsp;и&nbsp;перемещать&nbsp;этот&nbsp;объект</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ObjectSetInteger</span><span>(chart_ID,name,</span><span style="color: #0000ff;">OBJPROP_SELECTABLE</span><span>,selection);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ObjectSetInteger</span><span>(chart_ID,name,</span><span style="color: #0000ff;">OBJPROP_SELECTED</span><span>,selection);</span><br> <span style="color: #808080;">//---&nbsp;скроем&nbsp;(true)&nbsp;или&nbsp;отобразим&nbsp;(false)&nbsp;имя&nbsp;графического&nbsp;объекта&nbsp;в&nbsp;списке&nbsp;объектов</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ObjectSetInteger</span><span>(chart_ID,name,</span><span style="color: #0000ff;">OBJPROP_HIDDEN</span><span>,hidden);</span><br> <span style="color: #808080;">//---&nbsp;установим&nbsp;приоритет&nbsp;на&nbsp;получение&nbsp;события&nbsp;нажатия&nbsp;мыши&nbsp;на&nbsp;графике</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ObjectSetInteger</span><span>(chart_ID,name,</span><span style="color: #0000ff;">OBJPROP_ZORDER</span><span>,z_order);</span><br> <span style="color: #808080;">//---&nbsp;успешное&nbsp;выполнение</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">true</span><span>);</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Перемещает&nbsp;точку&nbsp;привязки&nbsp;эллипса&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">bool</span><span>&nbsp;EllipsePointChange(</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">long</span><span>&nbsp;&nbsp;&nbsp;chart_ID=0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;ID&nbsp;графика</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;name=</span><span style="color: #008080;">"Ellipse"</span><span>,&nbsp;</span><span style="color: #808080;">//&nbsp;имя&nbsp;эллипса</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;point_index=0,&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;номер&nbsp;точки&nbsp;привязки</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">time</span><span>=0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;координата&nbsp;времени&nbsp;точки&nbsp;привязки</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price=0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;координата&nbsp;цены&nbsp;точки&nbsp;привязки</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---&nbsp;если&nbsp;координаты&nbsp;точки&nbsp;не&nbsp;заданы,&nbsp;то&nbsp;перемещаем&nbsp;ее&nbsp;на&nbsp;текущий&nbsp;бар&nbsp;с&nbsp;ценой&nbsp;Bid</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!</span><span style="color: #0000ff;">time</span><span>)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">time</span><span>=</span><span style="color: #0000ff;">TimeCurrent</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!price)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price=</span><span style="color: #0000ff;">SymbolInfoDouble</span><span>(</span><span style="color: #0000ff;">Symbol</span><span>(),</span><span style="color: #0000ff;">SYMBOL_BID</span><span>);</span><br> <span style="color: #808080;">//---&nbsp;сбросим&nbsp;значение&nbsp;ошибки</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ResetLastError</span><span>();</span><br> <span style="color: #808080;">//---&nbsp;переместим&nbsp;точку&nbsp;привязки</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!</span><span style="color: #0000ff;">ObjectMove</span><span>(chart_ID,name,point_index,</span><span style="color: #0000ff;">time</span><span>,price))</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #0000ff;">__FUNCTION__</span><span>,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008080;">":&nbsp;не&nbsp;удалось&nbsp;переместить&nbsp;точку&nbsp;привязки!&nbsp;Код&nbsp;ошибки&nbsp;=&nbsp;"</span><span>,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">false</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;успешное&nbsp;выполнение</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">true</span><span>);</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Удаляет&nbsp;эллипс&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">bool</span><span>&nbsp;EllipseDelete(</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">long</span><span>&nbsp;&nbsp;&nbsp;chart_ID=0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;ID&nbsp;графика</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;name=</span><span style="color: #008080;">"Ellipse"</span><span>)&nbsp;</span><span style="color: #808080;">//&nbsp;имя&nbsp;эллипса</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---&nbsp;сбросим&nbsp;значение&nbsp;ошибки</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ResetLastError</span><span>();</span><br> <span style="color: #808080;">//---&nbsp;удалим&nbsp;эллипс</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!</span><span style="color: #0000ff;">ObjectDelete</span><span>(chart_ID,name))</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #0000ff;">__FUNCTION__</span><span>,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008080;">":&nbsp;не&nbsp;удалось&nbsp;удалить&nbsp;эллипс!&nbsp;Код&nbsp;ошибки&nbsp;=&nbsp;"</span><span>,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">false</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;успешное&nbsp;выполнение</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">true</span><span>);</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Проверяет&nbsp;значения&nbsp;точек&nbsp;привязки&nbsp;эллипса&nbsp;и&nbsp;для&nbsp;пустых&nbsp;значений&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//|&nbsp;устанавливает&nbsp;значения&nbsp;по&nbsp;умолчанию&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;ChangeEllipseEmptyPoints(</span><span style="color: #0000ff;">datetime</span><span>&nbsp;&amp;time1,</span><span style="color: #0000ff;">double</span><span>&nbsp;&amp;price1,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&nbsp;&amp;time2,</span><span style="color: #0000ff;">double</span><span>&nbsp;&amp;price2)</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---&nbsp;если&nbsp;время&nbsp;первой&nbsp;точки&nbsp;не&nbsp;задано,&nbsp;то&nbsp;она&nbsp;будет&nbsp;на&nbsp;текущем&nbsp;баре</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!time1)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time1=</span><span style="color: #0000ff;">TimeCurrent</span><span>();</span><br> <span style="color: #808080;">//---&nbsp;если&nbsp;цена&nbsp;первой&nbsp;точки&nbsp;не&nbsp;задана,&nbsp;то&nbsp;она&nbsp;будет&nbsp;иметь&nbsp;значение&nbsp;Bid</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!price1)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price1=</span><span style="color: #0000ff;">SymbolInfoDouble</span><span>(</span><span style="color: #0000ff;">Symbol</span><span>(),</span><span style="color: #0000ff;">SYMBOL_BID</span><span>);</span><br> <span style="color: #808080;">//---&nbsp;если&nbsp;время&nbsp;второй&nbsp;точки&nbsp;не&nbsp;задано,&nbsp;то&nbsp;она&nbsp;лежит&nbsp;на&nbsp;9&nbsp;баров&nbsp;левее&nbsp;второй</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!time2)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;массив&nbsp;для&nbsp;приема&nbsp;времени&nbsp;открытия&nbsp;10&nbsp;последних&nbsp;баров</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&nbsp;temp[10];</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">CopyTime</span><span>(</span><span style="color: #0000ff;">Symbol</span><span>(),</span><span style="color: #0000ff;">Period</span><span>(),time1,10,temp);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;установим&nbsp;вторую&nbsp;точку&nbsp;на&nbsp;9&nbsp;баров&nbsp;левее&nbsp;первой</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time2=temp[0];</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;если&nbsp;цена&nbsp;второй&nbsp;точки&nbsp;не&nbsp;задана,&nbsp;сдвинем&nbsp;ее&nbsp;на&nbsp;300&nbsp;пунктов&nbsp;ниже&nbsp;первой</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!price2)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price2=price1-300*</span><span style="color: #0000ff;">SymbolInfoDouble</span><span>(</span><span style="color: #0000ff;">Symbol</span><span>(),</span><span style="color: #0000ff;">SYMBOL_POINT</span><span>);</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Script&nbsp;program&nbsp;start&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnStart</span><span>()</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---&nbsp;проверим&nbsp;входные&nbsp;параметры&nbsp;на&nbsp;корректность</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(InpDate1&lt;0&nbsp;||&nbsp;InpDate1&gt;100&nbsp;||&nbsp;InpPrice1&lt;0&nbsp;||&nbsp;InpPrice1&gt;100&nbsp;||&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpDate2&lt;0&nbsp;||&nbsp;InpDate2&gt;100&nbsp;||&nbsp;InpPrice2&lt;0&nbsp;||&nbsp;InpPrice2&gt;100)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Ошибка!&nbsp;Некорректные&nbsp;значения&nbsp;входных&nbsp;параметров!"</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;количество&nbsp;видимых&nbsp;баров&nbsp;в&nbsp;окне&nbsp;графика</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;</span><span style="color: #0000ff;">bars</span><span>=(</span><span style="color: #0000ff;">int</span><span>)</span><span style="color: #0000ff;">ChartGetInteger</span><span>(0,</span><span style="color: #0000ff;">CHART_VISIBLE_BARS</span><span>);</span><br> <span style="color: #808080;">//---&nbsp;размер&nbsp;массива&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;accuracy=1000;</span><br> <span style="color: #808080;">//---&nbsp;массивы&nbsp;для&nbsp;хранения&nbsp;значений&nbsp;дат&nbsp;и&nbsp;цен,&nbsp;которые&nbsp;будут&nbsp;использованы</span><br> <span style="color: #808080;">//---&nbsp;для&nbsp;установки&nbsp;и&nbsp;изменения&nbsp;координат&nbsp;точек&nbsp;привязки&nbsp;эллипса</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&nbsp;date[];</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;price[];</span><br> <span style="color: #808080;">//---&nbsp;выделение&nbsp;памяти</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(date,</span><span style="color: #0000ff;">bars</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(price,accuracy);</span><br> <span style="color: #808080;">//---&nbsp;установить&nbsp;порядок&nbsp;данных&nbsp;как&nbsp;в&nbsp;таймсерии</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArraySetAsSeries</span><span>(date,</span><span style="color: #0000ff;">true</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArraySetAsSeries</span><span>(price,</span><span style="color: #0000ff;">true</span><span>);&nbsp;&nbsp;&nbsp;</span><br> <span style="color: #808080;">//---&nbsp;заполним&nbsp;массив&nbsp;дат</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ResetLastError</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">CopyTime</span><span>(</span><span style="color: #0000ff;">Symbol</span><span>(),</span><span style="color: #0000ff;">Period</span><span>(),0,</span><span style="color: #0000ff;">bars</span><span>,date)==-1)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Не&nbsp;удалось&nbsp;скопировать&nbsp;значения&nbsp;времени!&nbsp;Код&nbsp;ошибки&nbsp;=&nbsp;"</span><span>,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;заполним&nbsp;массив&nbsp;цен</span><br> <span style="color: #808080;">//---&nbsp;найдем&nbsp;максимальное&nbsp;и&nbsp;минимальное&nbsp;значение&nbsp;графика</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;max_price=</span><span style="color: #0000ff;">ChartGetDouble</span><span>(0,</span><span style="color: #0000ff;">CHART_PRICE_MAX</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;min_price=</span><span style="color: #0000ff;">ChartGetDouble</span><span>(0,</span><span style="color: #0000ff;">CHART_PRICE_MIN</span><span>);</span><br> <span style="color: #808080;">//---&nbsp;определим&nbsp;шаг&nbsp;изменения&nbsp;цены&nbsp;и&nbsp;заполним&nbsp;массив</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;step=(max_price-min_price)/accuracy;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;i=0;i&lt;accuracy;i++)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price[i]=min_price+i*step;</span><br> <span style="color: #808080;">//---&nbsp;определим&nbsp;точки&nbsp;для&nbsp;рисования&nbsp;эллипса</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;d1=InpDate1*(</span><span style="color: #0000ff;">bars</span><span>-1)/100;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;d2=InpDate2*(</span><span style="color: #0000ff;">bars</span><span>-1)/100;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;p1=InpPrice1*(accuracy-1)/100;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;p2=InpPrice2*(accuracy-1)/100;</span><br> <span style="color: #808080;">//---&nbsp;создадим&nbsp;эллипс</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!EllipseCreate(0,InpName,0,date[d1],price[p1],date[d2],price[p2],InpEllipseScale,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpColor,InpStyle,InpWidth,InpFill,InpBack,InpSelection,InpHidden,InpZOrder))</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;перерисуем&nbsp;график&nbsp;и&nbsp;подождем&nbsp;1&nbsp;секунду</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ChartRedraw</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Sleep</span><span>(1000);</span><br> <span style="color: #808080;">//---&nbsp;теперь&nbsp;будем&nbsp;перемещать&nbsp;точки&nbsp;привязки&nbsp;эллипса</span><br> <span style="color: #808080;">//---&nbsp;счетчик&nbsp;цикла</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;v_steps=accuracy/5;</span><br> <span style="color: #808080;">//---&nbsp;перемещаем&nbsp;первую&nbsp;и&nbsp;вторую&nbsp;точки&nbsp;привязки</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;i=0;i&lt;v_steps;i++)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;возьмем&nbsp;следующие&nbsp;значения</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(p1&lt;accuracy-1)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1+=1;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(p2&gt;1)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2-=1;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;сдвигаем&nbsp;точки</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!EllipsePointChange(0,InpName,0,date[d1],price[p1]))</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(!EllipsePointChange(0,InpName,1,date[d2],price[p2]))</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;проверим&nbsp;факт&nbsp;принудительного&nbsp;завершения&nbsp;скрипта</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">IsStopped</span><span>())</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;перерисуем&nbsp;график</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ChartRedraw</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;задержка&nbsp;в&nbsp;0.01&nbsp;секунды</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Sleep</span><span>(10);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;задержка&nbsp;в&nbsp;1&nbsp;секунду</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Sleep</span><span>(1000);</span><br> <span style="color: #808080;">//---&nbsp;начальное&nbsp;соотношение&nbsp;между&nbsp;временной&nbsp;и&nbsp;ценовой&nbsp;шкалами</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;ellipse_scale=InpEllipseScale;</span><br> <span style="color: #808080;">//---&nbsp;счетчик&nbsp;цикла</span><br> <span>&nbsp;&nbsp;&nbsp;v_steps=100;</span><br> <span style="color: #808080;">//---&nbsp;будем&nbsp;изменять&nbsp;соотношение&nbsp;между&nbsp;временной&nbsp;и&nbsp;ценовой&nbsp;шкалами&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;i=0;i&lt;v_steps;i++)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ellipse_scale+=2.0/v_steps;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;установим&nbsp;соотношение&nbsp;между&nbsp;временной&nbsp;и&nbsp;ценовой&nbsp;шкалами&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>&nbsp;(!</span><span style="color: #0000ff;">ObjectSetDouble</span><span>(0,InpName,</span><span style="color: #0000ff;">OBJPROP_SCALE</span><span>,ellipse_scale))&nbsp;</span><span style="color: #0000ff;">return</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;проверим&nbsp;факт&nbsp;принудительного&nbsp;завершения&nbsp;скрипта</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">IsStopped</span><span>())</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;перерисуем&nbsp;график</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ChartRedraw</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;задержка&nbsp;в&nbsp;0.02&nbsp;секунды</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Sleep</span><span>(20);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;задержка&nbsp;в&nbsp;1&nbsp;секунду</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Sleep</span><span>(1000);</span><br> <span style="color: #808080;">//---&nbsp;удалим&nbsp;эллипс&nbsp;с&nbsp;графика</span><br> <span>&nbsp;&nbsp;&nbsp;EllipseDelete(0,InpName);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ChartRedraw</span><span>();</span><br> <span style="color: #808080;">//---&nbsp;задержка&nbsp;в&nbsp;1&nbsp;секунду</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Sleep</span><span>(1000);</span><br> <span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;}</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<br>