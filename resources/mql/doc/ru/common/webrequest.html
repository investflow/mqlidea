<h1>WebRequest</h1> 
<p><span>Отправляет HTTP-запрос на указанный сервер. Существует два варианта функции:</span></p> 
<p><span>1. </span><span style="font-weight: bold;">Для отправки простых запросов </span><span>вида "ключ=значение" с использованием заголовка Content-Type: application/x-www-form-urlencoded.</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr style="text-align:left;vertical-align:top;"> 
    <td style="vertical-align:top; padding:3px;"><p><span>int&nbsp;&nbsp;</span><span>WebRequest</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>const&nbsp;string</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>method</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;метод&nbsp;HTTP&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>const&nbsp;string&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>url</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;url-адрес</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>const&nbsp;string&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>cookie</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;cookie</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>const&nbsp;string&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>referer</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;referer</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>timeout</span><span>,</span><span>&nbsp;&nbsp;&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;таймаут</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>const&nbsp;char&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>&amp;data[]</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;массив&nbsp;тела&nbsp;HTTP-сообщения</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>data_size</span><span>,</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>&nbsp;&nbsp;</span><span>//&nbsp;размер&nbsp;массива&nbsp;data[]&nbsp;в&nbsp;байтах</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>&amp;result[]</span><span>,</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;массив&nbsp;с&nbsp;данными&nbsp;ответа&nbsp;сервера</span><br> <span>&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>&amp;result_headers&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;заголовки&nbsp;ответа&nbsp;сервера</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>2. </span><span style="font-weight: bold;">Для отправки запросов произвольного типа</span><span> с указанием собственного</span><span> набора заголовков для более гибкого взаимодействия с различными Web-сервисами.</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr style="text-align:left;vertical-align:top;"> 
    <td style="vertical-align:top; padding:3px;"><p><span>int&nbsp;&nbsp;</span><span>WebRequest</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>const&nbsp;string</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>method</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;метод&nbsp;HTTP</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>const&nbsp;string&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>url</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;url-адрес</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>const&nbsp;string&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>headers</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;заголовки&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>timeout</span><span>,</span><span>&nbsp;&nbsp;&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;таймаут</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>const&nbsp;char&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>&amp;data[]</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;массив&nbsp;тела&nbsp;HTTP-сообщения</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>&amp;result[]</span><span>,</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;массив&nbsp;с&nbsp;данными&nbsp;ответа&nbsp;сервера</span><br> <span>&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>&amp;result_headers&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;заголовки&nbsp;ответа&nbsp;сервера</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Параметры</span></p> 
<p><span>method</span></p> 
<p><span>[in] &nbsp;Метод HTTP.</span></p> 
<p><span>url</span></p> 
<p><span>[in] &nbsp;URL-адрес.</span></p> 
<p><span>headers</span></p> 
<p><span>[in] &nbsp;Заголовки запроса вида "ключ: значение", разделенные переносом строки "\r\n".</span></p> 
<p><span>cookie</span></p> 
<p><span>[in] &nbsp;Значение Cookie.</span></p> 
<p><span>referer</span></p> 
<p><span>[in] &nbsp;Значение заголовка Referer HTTP-запроса.</span></p> 
<p><span>timeout</span></p> 
<p><span>[in] &nbsp;Таймаут в миллисекундах.</span></p> 
<p><span>data[]</span></p> 
<p><span>[in] &nbsp;Массив данных тела HTTP-сообщения.</span></p> 
<p><span>data_size</span></p> 
<p><span>[in] &nbsp;Размер массива data[].</span></p> 
<p><span>result[]</span></p> 
<p><span>[out] &nbsp;Массив с данными ответа сервера.</span></p> 
<p><span>result_headers</span></p> 
<p><span>[out] Заголовки ответа сервера.</span></p> 
<p><span>Возвращаемое значение</span></p> 
<p><span>Код ответа HTTP-сервера либо -1 в случае ошибки.</span></p> 
<p><span>Примечание</span></p> 
<p><span>Для использования функции WebRequest() следует добавить адреса серверов в список разрешенных URL во вкладке "Советники" окна "Настройки". Порт сервера выбирается автоматически на основе указанного протокола - 80 для "http://" и 443 для "https://".</span></p> 
<p><span>Функция WebRequest() является синхронной, это означает, что она приостанавливает выполнение программы и ждет ответа от запрашиваемого сервера. Так как задержки при получении ответа на отправленный запрос могут быть большими, то функция запрещена для вызовов из индикаторов, поскольку индикаторы работают в едином потоке, общем для всех индикаторов и графиков на данном символе. Задержка выполнения индикатора на одном из графиков символа может привести к остановке обновления всех графиков по данному символу. </span></p> 
<p><span>Функцию можно вызывать только из экспертов и скриптов, так как они работают в собственном потоке выполнения. При вызове из индикатора <a href="/ru/check/getlasterror">GetLastError()</a> вернет ошибку 4060 – "Функция не разрешена".</span></p> 
<p><span>При работе в <a href="/ru/runtime/testing#alert_etc">тестере стратегий</a> функция WebRequest() не выполняется.</span></p> 
<p><span style="font-weight: bold;">Пример использования 1-го варианта функции </span><span>WebRequest()</span><span style="font-weight: bold;">:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr style="text-align:left;vertical-align:top;"> 
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnStart</span><span>()</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;cookie=</span><span style="color: #0000ff;">NULL</span><span>,headers;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">char</span><span>&nbsp;post[],result[];</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;res;</span><br> <span style="color: #808080;">//---&nbsp;для&nbsp;работы&nbsp;с&nbsp;сервером&nbsp;необходимо&nbsp;добавить&nbsp;URL&nbsp;"https://www.google.com/finance"&nbsp;</span><br> <span style="color: #808080;">//---&nbsp;в&nbsp;список&nbsp;разрешенных&nbsp;URL&nbsp;(Главное&nbsp;меню-&gt;Сервис-&gt;Настройки,&nbsp;вкладка&nbsp;"Советники"):</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;google_url=</span><span style="color: #008080;">"https://www.google.com/finance"</span><span>;</span><br> <span style="color: #808080;">//---&nbsp;обнуляем&nbsp;код&nbsp;последней&nbsp;ошибки</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ResetLastError</span><span>();</span><br> <span style="color: #808080;">//---&nbsp;загрузка&nbsp;html-страницы&nbsp;с&nbsp;Google&nbsp;Finance</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int&nbsp;</span><span>timeout=5000;&nbsp;</span><span style="color: #808080;">//---&nbsp;timeout&nbsp;менее&nbsp;1000&nbsp;(1&nbsp;сек.)&nbsp;недостаточен&nbsp;при&nbsp;низкой&nbsp;скорости&nbsp;Интернета</span><br> <span>&nbsp;&nbsp;&nbsp;res=</span><span style="color: #0000ff;">WebRequest</span><span>(</span><span style="color: #008080;">"GET"</span><span>,google_url,cookie,</span><span style="color: #0000ff;">NULL</span><span>,timeout,post,0,result,headers);</span><br> <span style="color: #808080;">//---&nbsp;проверка&nbsp;ошибок</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(res==-1)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Ошибка&nbsp;в&nbsp;WebRequest.&nbsp;Код&nbsp;ошибки&nbsp;&nbsp;="</span><span>,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;возможно,&nbsp;URL&nbsp;отсутствует&nbsp;в&nbsp;списке,&nbsp;выводим&nbsp;сообщение&nbsp;о&nbsp;необходимости&nbsp;его&nbsp;добавления</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">MessageBox</span><span>(</span><span style="color: #008080;">"Необходимо&nbsp;добавить&nbsp;адрес&nbsp;'"</span><span>+google_url+</span><span style="color: #008080;">"'&nbsp;в&nbsp;список&nbsp;разрешенных&nbsp;URL&nbsp;во&nbsp;вкладке&nbsp;'Советники'"</span><span>,</span><span style="color: #008080;">"Ошибка"</span><span>,</span><span style="color: #0000ff;">MB_ICONINFORMATION</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">else</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;успешная&nbsp;загрузка</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">PrintFormat</span><span>(</span><span style="color: #008080;">"Файл&nbsp;успешно&nbsp;загружен,&nbsp;Размер&nbsp;файла&nbsp;=%d&nbsp;байт."</span><span>,</span><span style="color: #0000ff;">ArraySize</span><span>(result));</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;сохраняем&nbsp;данные&nbsp;в&nbsp;файл</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;filehandle=</span><span style="color: #0000ff;">FileOpen</span><span>(</span><span style="color: #008080;">"GoogleFinance.htm"</span><span>,</span><span style="color: #0000ff;">FILE_WRITE</span><span>|</span><span style="color: #0000ff;">FILE_BIN</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;проверка&nbsp;ошибки</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(filehandle!=</span><span style="color: #0000ff;">INVALID_HANDLE</span><span>)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;сохраняем&nbsp;содержимое&nbsp;массива&nbsp;result[]&nbsp;в&nbsp;файл</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">FileWriteArray</span><span>(filehandle,result,0,</span><span style="color: #0000ff;">ArraySize</span><span>(result));</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;закрываем&nbsp;файл</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">FileClose</span><span>(filehandle);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">else</span><span>&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Ошибка&nbsp;в&nbsp;FileOpen.&nbsp;Код&nbsp;ошибки&nbsp;="</span><span>,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;}</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>&nbsp;</span></p> 
<p><span style="font-weight: bold;">Пример использования 2-го варианта функции </span><span>WebRequest()</span><span style="font-weight: bold;">:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr style="text-align:left;vertical-align:top;"> 
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">link</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008080;">"https://www.mql5.com"</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">version</span><span>&nbsp;&nbsp;&nbsp;</span><span style="color: #008080;">"1.00"</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">strict</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">script_show_inputs</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">description</span><span>&nbsp;</span><span style="color: #008080;">"Пример&nbsp;скрипта,&nbsp;который&nbsp;публикует&nbsp;сообщение&nbsp;"</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">description</span><span>&nbsp;</span><span style="color: #008080;">"пользователя&nbsp;в&nbsp;ленте&nbsp;на&nbsp;mql5.com"</span><br> <span>&nbsp;</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;</span><span style="color: #800000;">InpLogin</span><span>&nbsp;&nbsp;&nbsp;=</span><span style="color: #008080;">""</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//Ваш&nbsp;аккаунт&nbsp;в&nbsp;MQL5.com</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;</span><span style="color: #800000;">InpPassword</span><span>=</span><span style="color: #008080;">""</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//Пароль&nbsp;для&nbsp;вашего&nbsp;аккаунта</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;</span><span style="color: #800000;">InpFileName</span><span>=</span><span style="color: #008080;">"EURUSDM5.png"</span><span>;&nbsp;</span><span style="color: #808080;">//Картинка&nbsp;в&nbsp;папке&nbsp;MQL5/Files/</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;</span><span style="color: #800000;">InpFileType</span><span>=</span><span style="color: #008080;">"image/png"</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//Правильный&nbsp;mime&nbsp;type&nbsp;картинки</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Публикация&nbsp;сообщения&nbsp;с&nbsp;картинкой&nbsp;в&nbsp;ленте&nbsp;mql5.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">bool</span><span>&nbsp;PostToNewsFeed(</span><span style="color: #0000ff;">string</span><span>&nbsp;login,</span><span style="color: #0000ff;">string</span><span>&nbsp;password,</span><span style="color: #0000ff;">string</span><span>&nbsp;text,</span><span style="color: #0000ff;">string</span><span>&nbsp;filename,</span><span style="color: #0000ff;">string</span><span>&nbsp;filetype)</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;res;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;для&nbsp;помещения&nbsp;результата&nbsp;выполнения&nbsp;операций</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">char</span><span>&nbsp;&nbsp;&nbsp;data[];&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;массив&nbsp;с&nbsp;данными&nbsp;для&nbsp;отправки&nbsp;POST-запросов</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">char</span><span>&nbsp;&nbsp;&nbsp;file[];&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;сюда&nbsp;прочитаем&nbsp;картинку</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;str=</span><span style="color: #008080;">"Login="</span><span>+login+</span><span style="color: #008080;">"&amp;Password="</span><span>+password;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;auth,sep=</span><span style="color: #008080;">"-------Jyecslin9mp8RdKV"</span><span>;&nbsp;</span><span style="color: #808080;">//&nbsp;разделитель&nbsp;данных&nbsp;формата&nbsp;multipart</span><br> <span style="color: #808080;">//---&nbsp;имеется&nbsp;файл&nbsp;-&nbsp;пробуем&nbsp;прочитать&nbsp;его</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(filename!=</span><span style="color: #0000ff;">NULL</span><span>&nbsp;&amp;&amp;&nbsp;filename!=</span><span style="color: #008080;">""</span><span>)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res=</span><span style="color: #0000ff;">FileOpen</span><span>(filename,</span><span style="color: #0000ff;">FILE_READ</span><span>|</span><span style="color: #0000ff;">FILE_BIN</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(res&lt;0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Ошибка&nbsp;открытия&nbsp;файла&nbsp;\""+filename+"</span><span>\</span><span style="color: #008080;">""</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">false</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;читаем&nbsp;данные&nbsp;файла</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">FileReadArray</span><span>(res,file)!=</span><span style="color: #0000ff;">FileSize</span><span>(res))</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">FileClose</span><span>(res);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Ошибка&nbsp;чтения&nbsp;файла&nbsp;\""+filename+"</span><span>\</span><span style="color: #008080;">""</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">false</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">FileClose</span><span>(res);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;сформируем&nbsp;тело&nbsp;POST&nbsp;запроса&nbsp;на&nbsp;авторизацию</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(data,</span><span style="color: #0000ff;">StringToCharArray</span><span>(str,data,0,</span><span style="color: #0000ff;">WHOLE_ARRAY</span><span>,</span><span style="color: #0000ff;">CP_UTF8</span><span>)-1);</span><br> <span style="color: #808080;">//---&nbsp;сбросим&nbsp;код&nbsp;ошибки</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ResetLastError</span><span>();</span><br> <span style="color: #808080;">//---&nbsp;выполняем&nbsp;запрос&nbsp;на&nbsp;авторизацию</span><br> <span>&nbsp;&nbsp;&nbsp;res=</span><span style="color: #0000ff;">WebRequest</span><span>(</span><span style="color: #008080;">"POST"</span><span>,</span><span style="color: #008080;">"https://www.mql5.com/ru/auth_login"</span><span>,</span><span style="color: #0000ff;">NULL</span><span>,0,data,data,str);</span><br> <span style="color: #808080;">//---&nbsp;если&nbsp;авторизация&nbsp;не&nbsp;удалась</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(res!=200)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Ошибка&nbsp;авторизации&nbsp;#"</span><span>+(</span><span style="color: #0000ff;">string</span><span>)res+</span><span style="color: #008080;">",&nbsp;LastError="</span><span>+(</span><span style="color: #0000ff;">string</span><span>)</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">false</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;вычитаем&nbsp;из&nbsp;заголовка&nbsp;ответа&nbsp;сервера&nbsp;cookie&nbsp;авторизации</span><br> <span>&nbsp;&nbsp;&nbsp;res=</span><span style="color: #0000ff;">StringFind</span><span>(str,</span><span style="color: #008080;">"Set-Cookie:&nbsp;auth="</span><span>);</span><br> <span style="color: #808080;">//---&nbsp;если&nbsp;cookie&nbsp;не&nbsp;найден,&nbsp;сообщим&nbsp;об&nbsp;ошибке</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(res&lt;0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Ошибка,&nbsp;данные&nbsp;авторизации&nbsp;не&nbsp;найдены&nbsp;в&nbsp;ответе&nbsp;сервера&nbsp;(проверте&nbsp;логин/пароль)"</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">false</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;запомним&nbsp;авторизационные&nbsp;данные&nbsp;и&nbsp;сформируем&nbsp;заголовок&nbsp;для&nbsp;последующих&nbsp;запросов</span><br> <span>&nbsp;&nbsp;&nbsp;auth=</span><span style="color: #0000ff;">StringSubstr</span><span>(str,res+12);</span><br> <span>&nbsp;&nbsp;&nbsp;auth=</span><span style="color: #008080;">"Cookie:&nbsp;"</span><span>+</span><span style="color: #0000ff;">StringSubstr</span><span>(auth,0,</span><span style="color: #0000ff;">StringFind</span><span>(auth,</span><span style="color: #008080;">";"</span><span>)+1)+</span><span style="color: #008080;">"\r\n"</span><span>;</span><br> <span style="color: #808080;">//---&nbsp;если&nbsp;имеется&nbsp;файл&nbsp;данных,&nbsp;отправляем&nbsp;его&nbsp;на&nbsp;сервер</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">ArraySize</span><span>(file)!=0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;сформируем&nbsp;тело&nbsp;запроса</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str=</span><span style="color: #008080;">"--"</span><span>+sep+</span><span style="color: #008080;">"\r\n"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=</span><span style="color: #008080;">"Content-Disposition:&nbsp;form-data;&nbsp;name=\"</span><span>attachedFile_imagesLoader\</span><span style="color: #008080;">";&nbsp;filename=\""+filename+"</span><span>\</span><span style="color: #008080;">"\r\n"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=</span><span style="color: #008080;">"Content-Type:&nbsp;"</span><span>+filetype+</span><span style="color: #008080;">"\r\n\r\n"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res&nbsp;=</span><span style="color: #0000ff;">StringToCharArray</span><span>(str,data);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res+=</span><span style="color: #0000ff;">ArrayCopy</span><span>(data,file,res-1,0);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res+=</span><span style="color: #0000ff;">StringToCharArray</span><span>(</span><span style="color: #008080;">"\r\n--"</span><span>+sep+</span><span style="color: #008080;">"--\r\n"</span><span>,data,res-1);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(data,</span><span style="color: #0000ff;">ArraySize</span><span>(data)-1);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;сформируем&nbsp;заголовок&nbsp;запроса</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str=auth+</span><span style="color: #008080;">"Content-Type:&nbsp;multipart/form-data;&nbsp;boundary="</span><span>+sep+</span><span style="color: #008080;">"\r\n"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;сбросим&nbsp;код&nbsp;ошибки</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ResetLastError</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;выполняем&nbsp;запрос&nbsp;на&nbsp;передачу&nbsp;файла&nbsp;изображения&nbsp;на&nbsp;сервер</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res=</span><span style="color: #0000ff;">WebRequest</span><span>(</span><span style="color: #008080;">"POST"</span><span>,</span><span style="color: #008080;">"https://www.mql5.com/upload_file"</span><span>,str,0,data,data,str);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;проверим&nbsp;результат&nbsp;запроса</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(res!=200)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Ошибка&nbsp;передачи&nbsp;файла&nbsp;на&nbsp;сервер&nbsp;#"</span><span>+(</span><span style="color: #0000ff;">string</span><span>)res+</span><span style="color: #008080;">",&nbsp;LastError="</span><span>+(</span><span style="color: #0000ff;">string</span><span>)</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">false</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;получим&nbsp;ссылку&nbsp;на&nbsp;картинку,&nbsp;которую&nbsp;загрузили&nbsp;на&nbsp;сервер</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str=</span><span style="color: #0000ff;">CharArrayToString</span><span>(data);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">StringFind</span><span>(str,</span><span style="color: #008080;">"{\"</span><span>Url\</span><span style="color: #008080;">":\"")==0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</span><span style="color: #0000ff;">StringFind</span><span>(str,</span><span style="color: #008080;">"\"",8);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filename=</span><span style="color: #0000ff;">StringSubstr</span><span>(str,8,res-8);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;при&nbsp;ошибке&nbsp;закачки&nbsp;файла,&nbsp;вернётся&nbsp;пустая&nbsp;ссылка</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(filename==</span><span style="color: #008080;">""</span><span>)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Передача&nbsp;файла&nbsp;на&nbsp;сервер&nbsp;не&nbsp;удалась"</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">false</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;сформируем&nbsp;тело&nbsp;запроса&nbsp;публикации&nbsp;сообщения&nbsp;на&nbsp;сервере</span><br> <span>&nbsp;&nbsp;&nbsp;str&nbsp;=</span><span style="color: #008080;">"--"</span><span>+sep+</span><span style="color: #008080;">"\r\n"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;str+=</span><span style="color: #008080;">"Content-Disposition:&nbsp;form-data;&nbsp;name=\"</span><span>content\</span><span style="color: #008080;">"\r\n\r\n"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;str+=text+</span><span style="color: #008080;">"\r\n"</span><span>;</span><br> <span style="color: #808080;">//---&nbsp;на&nbsp;каких&nbsp;языках&nbsp;сайта&nbsp;mql5.com&nbsp;будет&nbsp;доступна&nbsp;публикация&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;str+=</span><span style="color: #008080;">"--"</span><span>+sep+</span><span style="color: #008080;">"\r\n"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;str+=</span><span style="color: #008080;">"Content-Disposition:&nbsp;form-data;&nbsp;name=\"</span><span>AllLanguages\</span><span style="color: #008080;">"\r\n\r\n"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;str+=</span><span style="color: #008080;">"on\r\n"</span><span>;</span><br> <span style="color: #808080;">//---&nbsp;если&nbsp;картинка&nbsp;была&nbsp;загружена&nbsp;на&nbsp;сервер&nbsp;-&nbsp;передадим&nbsp;ссылку&nbsp;на&nbsp;неё</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">ArraySize</span><span>(file)!=0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=</span><span style="color: #008080;">"--"</span><span>+sep+</span><span style="color: #008080;">"\r\n"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=</span><span style="color: #008080;">"Content-Disposition:&nbsp;form-data;&nbsp;name=\"</span><span>attachedImage_0\</span><span style="color: #008080;">"\r\n\r\n"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=filename+</span><span style="color: #008080;">"\r\n"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;завершающая&nbsp;строка&nbsp;multipart-запроса</span><br> <span>&nbsp;&nbsp;&nbsp;str+=</span><span style="color: #008080;">"--"</span><span>+sep+</span><span style="color: #008080;">"--\r\n"</span><span>;</span><br> <span style="color: #808080;">//---&nbsp;собираем&nbsp;тело&nbsp;POST-запроса&nbsp;в&nbsp;одну&nbsp;строку&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">StringToCharArray</span><span>(str,data,0,</span><span style="color: #0000ff;">WHOLE_ARRAY</span><span>,</span><span style="color: #0000ff;">CP_UTF8</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(data,</span><span style="color: #0000ff;">ArraySize</span><span>(data)-1);</span><br> <span style="color: #808080;">//---&nbsp;подготовим&nbsp;заголовок&nbsp;запроса&nbsp;&nbsp;&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;str=auth+</span><span style="color: #008080;">"Content-Type:&nbsp;multipart/form-data;&nbsp;boundary="</span><span>+sep+</span><span style="color: #008080;">"\r\n"</span><span>;</span><br> <span style="color: #808080;">//---&nbsp;выполняем&nbsp;запрос&nbsp;на&nbsp;публикацию&nbsp;сообщение&nbsp;в&nbsp;ленте&nbsp;пользователя&nbsp;mql5.com</span><br> <span>&nbsp;&nbsp;&nbsp;res=</span><span style="color: #0000ff;">WebRequest</span><span>(</span><span style="color: #008080;">"POST"</span><span>,</span><span style="color: #008080;">"https://www.mql5.com/ru/users/"</span><span>+login+</span><span style="color: #008080;">"/wall"</span><span>,str,0,data,data,str);</span><br> <span style="color: #808080;">//---&nbsp;в&nbsp;случае&nbsp;успешной&nbsp;публикации&nbsp;вернем&nbsp;true</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(res==200);</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Script&nbsp;program&nbsp;start&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnStart</span><span>()</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---&nbsp;опубликуем&nbsp;пост&nbsp;на&nbsp;mql5.com&nbsp;c&nbsp;картинкой,&nbsp;путь&nbsp;к&nbsp;которой&nbsp;возьмем&nbsp;из&nbsp;параметра&nbsp;InpFileName</span><br> <span>&nbsp;&nbsp;&nbsp;PostToNewsFeed(</span><span style="color: #800000;">InpLogin</span><span>,</span><span style="color: #800000;">InpPassword</span><span>,</span><span style="color: #008080;">"Проверка&nbsp;расширенной&nbsp;версии&nbsp;функции&nbsp;WebRequest\r\n"</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008080;">"(Данное&nbsp;сообщение&nbsp;размещено&nbsp;скриптом&nbsp;WebRequest.mq5)"</span><span>,</span><span style="color: #800000;">InpFileName</span><span>,</span><span style="color: #800000;">InpFileType</span><span>);</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>&nbsp;</span></p> 
<br>