<h1>OrderSend</h1> 
<p><span>Основная функция, используемая для совершения торговых операций или установки отложенного ордера.</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>int&nbsp;&nbsp;</span><span>OrderSend</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;string&nbsp;</span><span>&nbsp;&nbsp;</span><span>symbol</span><span style="color: #000000;">,</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;символ</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>cmd</span><span style="color: #000000;">,&nbsp;</span><span>&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;торговая&nbsp;операция</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double&nbsp;</span><span>&nbsp;&nbsp;</span><span>volume</span><span style="color: #000000;">,</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;количество&nbsp;лотов</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double&nbsp;</span><span>&nbsp;&nbsp;</span><span>price</span><span style="color: #000000;">,</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;цена</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>slippage</span><span style="color: #000000;">,</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;проскальзывание</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double&nbsp;</span><span>&nbsp;&nbsp;</span><span>stoploss</span><span style="color: #000000;">,&nbsp;</span><span>&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;stop&nbsp;loss</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double&nbsp;</span><span>&nbsp;&nbsp;</span><span>takeprofit</span><span style="color: #000000;">,</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;take&nbsp;profit</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>string&nbsp;</span><span>&nbsp;&nbsp;</span><span>comment=NULL</span><span style="color: #000000;">,&nbsp;</span><span>&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;комментарий</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>magic=0</span><span style="color: #000000;">,&nbsp;</span><span>&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;идентификатор</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>datetime</span><span>&nbsp;</span><span>expiration=0</span><span style="color: #000000;">,&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;срок&nbsp;истечения&nbsp;ордера</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>color&nbsp;</span><span>&nbsp;&nbsp;&nbsp;</span><span>arrow_color=clrNONE&nbsp;</span><span style="color: #000000;">&nbsp;</span><span>//&nbsp;цвет</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Параметры</span></p> 
<p><span>symbol</span></p> 
<p><span>[in] &nbsp;Наименование финансового инструмента, с которым проводится торговая операция.</span></p> 
<p><span>cmd</span></p> 
<p><span>[in] &nbsp;Торговая операция. Может быть любым из значений <a href="/constants/tradingconstants/orderproperties">торговых операций</a>.</span></p>
<p><span>volume</span></p> 
<p><span>[in] &nbsp;Количество лотов.</span></p> 
<p><span>price</span></p> 
<p><span>[in] &nbsp;Цена открытия.</span></p> 
<p><span>slippage</span></p> 
<p><span>[in] &nbsp;Максимально допустимое отклонение цены для рыночных ордеров (ордеров на покупку или продажу).</span></p> 
<p><span>stoploss</span></p> 
<p><span>[in] &nbsp;Цена закрытия ордера при достижении уровня убыточности (0 в случае отсутствия уровня убыточности).</span></p> 
<p><span>takeprofit</span></p> 
<p><span>[in] &nbsp;Цена закрытия ордера при достижении уровня прибыльности (0 в случае отсутствия уровня прибыльности).</span></p> 
<p><span>comment=NULL</span></p> 
<p><span>[in] &nbsp;Текст комментария ордера. Последняя часть комментария может быть изменена торговым сервером.</span></p> 
<p><span>magic=0</span></p> 
<p><span>[in] &nbsp;Магическое число ордера. Может использоваться как определяемый пользователем идентификатор.</span></p> 
<p><span>expiration=0</span></p> 
<p><span>[in] &nbsp;Срок истечения отложенного ордера.</span></p> 
<p><span>arrow_color=clrNONE</span></p> 
<p><span>[in] &nbsp;Цвет открывающей стрелки на графике. Если параметр отсутствует или его значение равно CLR_NONE, то открывающая стрелка не отображается на графике.</span></p> 
<p><span>Возвращаемое значение</span></p> 
<p><span>Возвращает номер тикета, который назначен ордеру торговым сервером или -1 в случае неудачи. </span><span>Чтобы получить информацию об </span><span><a href="/constants/errorswarnings/enum_trade_return_codes">ошибке</a></span><span>, необходимо вызвать функцию <a href="/check/getlasterror">GetLastError()</a>.</span></p>
<p><span>Примечание</span></p> 
<p><span>При открытии рыночного ордера (OP_SELL или OP_BUY) в качестве цены открытия могут использоваться только самые последние цены Bid (для продажи) или Ask (для покупки). Если операция проводится по финансовому инструменту, отличному от текущего, то для получения последних котировок по этому инструменту необходимо воспользоваться функцией <a href="/marketinformation/marketinfo">MarketInfo()</a> с параметром MODE_BID или MODE_ASK. </span></p>
<p><span>Нельзя использовать расчетную либо ненормализованную цену. Если запрашиваемой цены открытия не было в ценовом потоке, либо запрашиваемая цена не нормализована в соответствии с количеством знаков после десятичной точки, то будет сгенерирована ошибка 129 (ERR_INVALID_PRICE). Если запрашиваемая цена открытия сильно устарела, то независимо от значения параметра slippage будет сгенерирована ошибка 138 (ERR_REQUOTE). Если же запрашиваемая цена устарела, но еще присутствует в ценовом потоке, то ордер открывается по текущей цене и только в том случае, если текущая цена попадает в диапазон price+-slippage.</span></p> 
<p><span>Цены StopLoss и TakeProfit не могут располагаться слишком близко к рынку. Минимальное расстояние стопов в пунктах можно получить, используя функцию <a href="/marketinformation/marketinfo">MarketInfo()</a> с параметром MODE_STOPLEVEL. В случае ошибочных, а также ненормализованных стопов генерируется ошибка 130 (ERR_INVALID_STOPS). Нулевое значение MODE_STOPLEVEL означает либо отсутствие &nbsp;ограничения на минимальную дистанцию для стоп-лосса/тейк-профита, либо факт использования торговым сервером внешних механизмов динамического контроля уровней, которые не могут быть транслированы в терминал. Во втором случае GetLastError() может возвращать ошибку 130, так как уровень MODE_STOPLEVEL фактически является "плавающим".</span></p>
<p><span>При установке отложенного ордера цена открытия не может быть слишком близкой к рынку. Минимальное расстояние отложенной цены от текущей рыночной цены в пунктах также можно получить, используя функцию <a href="/marketinformation/marketinfo">MarketInfo()</a> с параметром MODE_STOPLEVEL. В случае неправильной цены открытия отложенного ордера будет сгенерирована ошибка 130 (ERR_INVALID_STOPS).</span></p>
<p><span>На некоторых торговых серверах может быть установлен запрет на применение срока истечения отложенных ордеров. В этом случае при попытке задать ненулевое значение в параметре expiration будет сгенерирована ошибка 147 (ERR_TRADE_EXPIRATION_DENIED).</span></p> 
<p><span>На некоторых торговых серверах может быть установлен лимит на общее количество открытых и отложенных ордеров. При превышении этого лимита новый ордер открыт не будет (отложенный ордер не будет установлен), и торговый сервер вернет ошибку 148 (ERR_TRADE_TOO_MANY_ORDERS).</span></p> 
<p><span style="font-weight: bold;">Пример:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Script&nbsp;program&nbsp;start&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnStart</span><span>()</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---&nbsp;получим&nbsp;минимальное&nbsp;значение&nbsp;Stop&nbsp;level</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;minstoplevel=</span><span style="color: #0000ff;">MarketInfo</span><span>(</span><span style="color: #0000ff;">Symbol</span><span>(),</span><span style="color: #0000ff;">MODE_STOPLEVEL</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Minimum&nbsp;Stop&nbsp;Level="</span><span>,minstoplevel,</span><span style="color: #008080;">"&nbsp;points"</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;price=</span><span style="color: #0000ff;">Ask</span><span>;</span><br> <span style="color: #808080;">//---&nbsp;вычисленные&nbsp;значения&nbsp;цен&nbsp;SL&nbsp;и&nbsp;TP&nbsp;должны&nbsp;быть&nbsp;нормализованы</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;stoploss=</span><span style="color: #0000ff;">NormalizeDouble</span><span>(</span><span style="color: #0000ff;">Bid</span><span>-minstoplevel*</span><span style="color: #0000ff;">Point</span><span>,</span><span style="color: #0000ff;">Digits</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;takeprofit=</span><span style="color: #0000ff;">NormalizeDouble</span><span>(</span><span style="color: #0000ff;">Bid</span><span>+minstoplevel*</span><span style="color: #0000ff;">Point</span><span>,</span><span style="color: #0000ff;">Digits</span><span>);</span><br> <span style="color: #808080;">//---&nbsp;размещаем&nbsp;рыночный&nbsp;ордер&nbsp;на&nbsp;покупку&nbsp;1&nbsp;лота</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;ticket=</span><span style="color: #0000ff;">OrderSend</span><span>(</span><span style="color: #0000ff;">Symbol</span><span>(),</span><span style="color: #0000ff;">OP_BUY</span><span>,1,price,3,stoploss,takeprofit,</span><span style="color: #008080;">"My&nbsp;order"</span><span>,16384,0,</span><span style="color: #0000ff;">clrGreen</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(ticket&lt;0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"OrderSend&nbsp;завершилась&nbsp;с&nbsp;ошибкой&nbsp;#"</span><span>,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">else</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Функция&nbsp;OrderSend&nbsp;успешно&nbsp;выполнена"</span><span>);</span><br> <span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;}</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<br>