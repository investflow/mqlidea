<h1>Направление индексации в массивах, буферах и таймсериях</h1> 
<p><span>Все массивы и индикаторные буферы по умолчанию имеют направление индексации слева направо. Индекс первого элемента всегда равен нулю. Таким образом, самый первый элемент массива или индикаторного буфера с индексом 0 по умолчанию находится на крайней левой позиции, последний элемент находится на крайней правой позиции.</span></p> 
<p><span>Индикаторный буфер представляет из себя <a href="/basis/types/dynamic_array">динамический массив</a> типа double, размером которого управляет клиентский терминал с тем, чтобы он всегда соответствовал количеству баров, на которых индикатор рассчитывается. Обычный динамический массив типа double назначается в качестве индикаторного буфера с помощью функции <a href="/customind/setindexbuffer">SetIndexBuffer()</a>. Для индикаторных буферов не требуется задавать размер с помощью функции <a href="/array/arrayresize">ArrayResize()</a>, исполняющая система терминала сама позаботится об этом.</span></p>
<p><span><a href="/series">Таймсерии</a> представляют из себя массивы с обратной индексацией, то есть самый первый элемент таймсерии находится на крайней правой позиции, а последний элемент таймсерии находится на крайней левой позиции. Так как таймсерии предназначены для хранения исторических ценовых данных по финансовым инструментам и обязательно содержат информацию о времени, то можно сказать, что самые свежие данные в таймсерии находятся в правой крайней позиции, а самые старые в крайней левой позиции. </span></p>
<p><span>Поэтому, элемент с индексом ноль в таймсерии содержит информацию о самой последней котировке по инструменту. Если таймсерия представляет данные по дневному таймфрейму, то на нулевой позиции содержатся данные текущего незавершенного дня, а на позиции с индексом один хранятся данные вчерашнего дня.</span></p> 
<h3>Изменение направления индексации</h3> 
<p><span>Функция <a href="/array/arraysetasseries">ArraySetAsSeries()</a> позволяет изменять способ доступа к элементам динамического массива, но при этом физически порядок хранения данных в памяти компьютера не изменяется. Эта функция просто изменяет способ адресации к элементам массива, поэтому при копировании одного массива в другой с помощью функции <a href="/array/arraycopy">ArrayCopy()</a> содержимое массива-приемника не будет зависеть от направления индексации в массиве-источнике.</span></p>
<p><span>Нельзя изменять направление индексации для статически распределенных массивов. Даже если массив был передан в качестве параметра в функцию, то и внутри этой функции попытки изменения направления индексации ни к чему не приведут.</span></p> 
<p><span>Для индикаторных буферов, как и для обычных массивов, также разрешается устанавливать направление индексации задом наперед как в таймсерии, то есть, обращение к нулевой позиции в индикаторном буфере в этом случае будет означать обращение к самому последнему значению в соответствующем индикаторном буфере и это будет соответствовать значению индикатора на самом последнем баре. При этом физически размещение данных в индикаторном буфере останется неизменным, как уже упоминалось.</span></p> 
<h3>Получение ценовых данных в индикаторах</h3> 
<p><span>В каждом <a href="/customind">пользовательском индикаторе</a> обязательно должна присутствовать функция <a href="/basis/function/events#oncalculate">OnCalculate()</a>, которой передаются ценовые данные, необходимые для расчета значений в индикаторных буферах. Направление индексации в этих переданных массивах можно выяснить с помощью функции <a href="/array/arraygetasseries">ArrayGetAsSeries()</a>. </span></p>
<p><span><a href="/basis/function/parameterpass">Переданные в функцию</a> массивы отражают ценовые данные, т.е. эти массивы имеют признак таймсерии и функция <a href="/array/arrayisseries">ArrayIsSeries()</a> вернет true при проверке этих массивов. Но тем не менее, направление индексации необходимо в любом случае проверять только функцией <a href="/array/arraygetasseries">ArrayGetAsSeries()</a>. </span></p>
<p><span>Чтобы не зависеть от умолчаний, необходимо безусловно вызывать функцию <a href="/array/arraysetasseries">ArraySetAsSeries()</a> для тех массивов, с которыми предполагается работать, и установить требуемое направление индексации.</span></p>
<h3>Получение ценовых данных и значений индикаторов</h3> 
<p><span>В экспертах, индикаторах и скриптах все массивы по умолчанию имеют направление индексации слева направо. При необходимости в любой mql4-программе можно запросить значения таймсерий по любому символу и таймфрейму, а также значения индикаторов, рассчитанных на любом символе и таймфрейме.</span></p> 
<p><span>Для получения таких данных служат функции Copy...():</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span><a href="/series/copyrates">CopyRates</a> – копирование ценовой истории в массив структур <a href="/constants/structures/mqlrates">MqlRates</a>;</span></p>
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span><a href="/series/copytime">CopyTime</a> – копирование значений Time в массив типа datetime;</span></p>
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span><a href="/series/copyopen">CopyOpen</a> – копирование значений Open в массив типа double;</span></p>
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span><a href="/series/copyhigh">CopyHigh</a> – копирование значений High в массив типа double;</span></p>
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span><a href="/series/copylow">CopyLow</a> – копирование значений Low в массив типа double;</span></p>
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span><a href="/series/copyclose">CopyClose</a> – копирование значений Close в массив типа double;</span></p>
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span><a href="/series/copytickvolume">CopyTickVolume</a> – копирование тиковых объемов в массив типа long;</span></p>
<p><span>&nbsp;</span></p> 
<p><span>Все эти функции работают одинаково, и поэтому достаточно рассмотреть механизм получения данных на примере CopyOpen(). Подразумевается, что все запрашиваемые данные имеют направление индексации, как в таймсерии, при этом подразумевается, что в позиции с индексом 0 (ноль) хранятся данные текущего незавершенного бара. Чтобы получить доступ к этим данным, нам необходимо скопировать нужный нам объем данных в массив-приемник, например, в массив </span><span style="font-style: italic;">buffer</span><span>. </span></p> 
<p><img alt="CopyOpen" width="656" height="214" style="margin:0;width:656px;height:214px;border:none" src="https://c.mql4.com/i/docs/ru/copyopen.png"></p> 
<p><span>При копировании необходимо указать стартовую позицию в массиве-источнике, начиная с которой будут копироваться данные в массив-приемник. В случае успеха в массив-получатель будет скопировано указанное количество элементов из массива-источник, в данном случае из индикаторного буфера. При этом независимо от того, какое направление индексации установлено в массиве получателе, копирование всегда производится так, как указано на рисунке. </span></p> 
<p><span>Смотри также</span></p> 
<p><span><a href="/series/timeseries_access">Организация доступа к данным</a></span></p>
<br>