<h1>FileOpen</h1> 
<p><span>Функция открывает файл с указанным именем и указанными флагами.</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>int&nbsp;&nbsp;</span><span>FileOpen</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;&nbsp;</span><span>file_name</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;имя&nbsp;файла</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>open_flags</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;комбинация&nbsp;флагов</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>short</span><span>&nbsp;&nbsp;&nbsp;</span><span>delimiter=';'</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;разделитель</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>uint</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>codepage=CP_ACP</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;кодовая&nbsp;страница</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Параметры</span></p> 
<p><span>file_name</span></p> 
<p><span>[in] &nbsp;Имя открываемого файла, может содержать подпапки. Если файл открывается для записи, то указанные подпапки будут созданы в случае их отсутствия.</span></p> 
<p><span>open_flags</span></p> 
<p><span>[in] <a href="/constants/io_constants/fileflags">комбинация флагов</a>, определяющая режим работы с файлом. Флаги определены следующим образом: </span><br> <span>FILE_READ файл открывается для чтения </span><br> <span>FILE_WRITE файл открывается для записи </span><br> <span>FILE_BIN двоичный режим чтения-записи (без преобразования из строки и в строку) </span><br> <span>FILE_CSV файл типа csv (все записанные элементы преобразуются к строкам соответствующего типа, unicode или ansi, и разделяются разделителем) </span><br> <span>FILE_TXT простой текстовый файл (тот же csv, однако разделитель не принимается во внимание) </span><br> <span>FILE_ANSI строки типа ANSI (однобайтовые символы) </span><br> <span>FILE_UNICODE строки типа UNICODE (двухбайтовые символы) </span><br> <span>FILE_SHARE_READ совместный доступ по чтению со стороны нескольких программ </span><br> <span>FILE_SHARE_WRITE совместный доступ по записи со стороны нескольких программ </span><br> <span>FILE_COMMON расположение файла в общей папке всех клиентских терминалов \Terminal\Common\Files</span></p>
<p><span>delimiter=';'</span></p> 
<p><span>[in] &nbsp;значение, используемое в качестве разделителя в txt или csv-файле. Если для csv-файла разделитель не указан, то по умолчанию используется ";". Если для txt-файла разделитель не указан, то никакой разделитель не используется. Если в качестве разделителя явно задано значение 0, то никакой разделитель не используется.</span></p> 
<p><span>codepage=CP_ACP</span></p> 
<p><span>[in] &nbsp;Необязательный параметр. Значение кодовой страницы. Для наиболее употребимых <a href="/constants/io_constants/codepageusage">кодовых страниц</a> предусмотрены соответствующие константы.</span></p>
<p><span>Возвращаемое значение</span></p> 
<p><span>В случае успешного открытия функция возвращает хэндл файла, который затем используется для доступа к данным файла. В случае неудачи возвращает </span><span><a href="/constants/namedconstants/otherconstants">INVALID_HANDLE</a>.</span></p>
<p><span>Примечание</span></p> 
<p><span>Из соображений безопасности в языке MQL4 строго контролируется работа с файлами. Файлы, с которыми проводятся файловые операции средствами языка MQL4, не могут находиться за пределами файловой "песочницы".</span></p> 
<p><span>Файл открывается в папке клиентского терминала в подпапке MQL4\Files (или Tester\Files в случае тестирования). Если среди флагов указан FILE_COMMON, то файл открывается в общей папке всех клиентских терминалов </span><span>\Terminal\Common\Files</span><span>.</span></p> 
<p><span>Можно открывать "именованные каналы" по следующим правилам:</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 1px 17px 1px 30px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>Имя канала - строка, которая должна иметь вид: "\\servername\pipe\pipename", где servername - имя сервера в сети, а pipename - имя канала. Если каналы используются на одном и том же компьютере, имя сервера может быть опущено, но вместо него нужно поставить точку: "\\.\pipe\pipename". Клиент, который пытается соединиться с каналом, должен знать его имя.</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 1px 17px 1px 30px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>Необходимо вызывать <a href="/files/fileflush">FileFlush()</a> и <a href="/files/fileseek">FileSeek()</a> на начало файла между последовательными операциями чтения из канала и записи в канал.</span></p>
<p><span>В приведенных строках используется специальный символ обратная косая черта '\', поэтому при написании имени в MQL4 программе '\' необходимо удваивать, то есть вышеприведенный пример написать в коде как &nbsp;"\\\\servername\\pipe\\pipename".</span></p> 
<p><span>Более подробно о работе с именованными каналами можно прочитать в статье "<a href="https://www.mql5.com/ru/articles/503" target="_blank">Связь с MetaTrader 5 через именованные каналы без применения DLL</a>"</span></p> 
<p><span style="font-weight: bold;">Пример:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Script&nbsp;program&nbsp;start&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnStart</span><span>()</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---&nbsp;неправильный&nbsp;способ&nbsp;открытия&nbsp;файла</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;</span><span style="color: #0000ff;">terminal_data_path</span><span>=</span><span style="color: #0000ff;">TerminalInfoString</span><span>(</span><span style="color: #0000ff;">TERMINAL_DATA_PATH</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;filename=</span><span style="color: #0000ff;">terminal_data_path</span><span>+</span><span style="color: #008080;">"\\MQL4\\Files\\"</span><span>+</span><span style="color: #008080;">"fractals.csv"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;filehandle=</span><span style="color: #0000ff;">FileOpen</span><span>(filename,</span><span style="color: #0000ff;">FILE_WRITE</span><span>|</span><span style="color: #0000ff;">FILE_CSV</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(filehandle&lt;0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Неудачная&nbsp;попытка&nbsp;открыть&nbsp;файл&nbsp;по&nbsp;абсолютному&nbsp;пути"</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Код&nbsp;ошибки&nbsp;"</span><span>,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;правильный&nbsp;способ&nbsp;работы&nbsp;в&nbsp;"файловой&nbsp;песочнице"</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ResetLastError</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;filehandle=</span><span style="color: #0000ff;">FileOpen</span><span>(</span><span style="color: #008080;">"fractals.csv"</span><span>,</span><span style="color: #0000ff;">FILE_WRITE</span><span>|</span><span style="color: #0000ff;">FILE_CSV</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(filehandle!=</span><span style="color: #0000ff;">INVALID_HANDLE</span><span>)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">FileWrite</span><span>(filehandle,</span><span style="color: #0000ff;">TimeCurrent</span><span>(),</span><span style="color: #0000ff;">Symbol</span><span>(),&nbsp;</span><span style="color: #0000ff;">EnumToString</span><span>(</span><span style="color: #0000ff;">ENUM_TIMEFRAMES</span><span>(</span><span style="color: #ff00ff;">_Period</span><span>)));</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">FileClose</span><span>(filehandle);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"FileOpen&nbsp;OK"</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">else</span><span>&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Операция&nbsp;FileOpen&nbsp;неудачна,&nbsp;ошибка&nbsp;"</span><span>,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span style="color: #808080;">//---&nbsp;еще&nbsp;один&nbsp;пример&nbsp;с&nbsp;созданием&nbsp;вложенной&nbsp;директории&nbsp;в&nbsp;MQL4\Files\</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;subfolder=</span><span style="color: #008080;">"Research"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;filehandle=</span><span style="color: #0000ff;">FileOpen</span><span>(subfolder+</span><span style="color: #008080;">"\\fractals.txt"</span><span>,</span><span style="color: #0000ff;">FILE_WRITE</span><span>|</span><span style="color: #0000ff;">FILE_CSV</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(filehandle!=</span><span style="color: #0000ff;">INVALID_HANDLE</span><span>)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">FileWrite</span><span>(filehandle,</span><span style="color: #0000ff;">TimeCurrent</span><span>(),</span><span style="color: #0000ff;">Symbol</span><span>(),&nbsp;</span><span style="color: #0000ff;">EnumToString</span><span>(</span><span style="color: #0000ff;">ENUM_TIMEFRAMES</span><span>(</span><span style="color: #ff00ff;">_Period</span><span>)));</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">FileClose</span><span>(filehandle);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Файл&nbsp;должен&nbsp;быть&nbsp;создан&nbsp;в&nbsp;папке&nbsp;"</span><span>+</span><span style="color: #0000ff;">terminal_data_path</span><span>+</span><span style="color: #008080;">"\\"</span><span>+subfolder);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">else</span><span>&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Операция&nbsp;FileOpen&nbsp;неудачна,&nbsp;ошибка&nbsp;"</span><span>,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;}</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Смотри также</span></p> 
<p><span><a href="/constants/io_constants/codepageusage">Использование кодовой страницы</a>, <a href="/files/filefindfirst">FileFindFirst()</a>, <a href="/files/foldercreate">FolderCreate()</a>, <a href="/constants/io_constants/fileflags">Флаги открытия файлов</a></span></p>
<br>