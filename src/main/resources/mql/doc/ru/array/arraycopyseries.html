<h1>ArrayCopySeries</h1> 
<p><span>Копирует массив-таймсерию в пользовательский массив и возвращает количество скопированных элементов.</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>int&nbsp;&nbsp;</span><span>ArrayCopySeries</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>void&amp;</span><span>&nbsp;&nbsp;</span><span>array[]</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;массив,&nbsp;переданный&nbsp;по&nbsp;ссылке</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>series_index</span><span>,</span><span>&nbsp;&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;идентификатор&nbsp;массива-таймсерии</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;</span><span>symbol=NULL</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;инструмент</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>timeframe=0&nbsp;&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;таймфрейм</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Параметры</span></p> 
<p><span>array[]</span></p> 
<p><span>[out] &nbsp;Ссылка на одномерный числовой массив.</span></p> 
<p><span>series_index</span></p> 
<p><span>[in] &nbsp;Идентификатор массива-таймсерии. Должен быть одним из перечисленных <a href="/constants/indicatorconstants/seriesconst">идентификаторов таймсерий</a>.</span></p>
<p><span>symbol</span></p> 
<p><span>[in] &nbsp;Наименование инструмента (символ валютной пары).</span></p> 
<p><span>timeframe</span></p> 
<p><span>[in] &nbsp;Период. Может быть любым значением из <a href="/constants/chartconstants/enum_timeframes">перечисленных периодов</a>.</span></p>
<p><span>Возвращаемое значение</span></p> 
<p><span>Возвращает количество скопированных элементов, либо -1 в случае неудачи.</span></p> 
<p><span>Если копируются данные "чужого" инструмента и/или таймфрейма, то возможна ситуация отсутствия требуемых данных. В этом случае в переменную last_error будет помещена ошибка ERR_HISTORY_WILL_UPDATED (4066 - запрошенные исторические данные в состоянии обновления) и необходимо через некоторое время повторить попытку копирования.</span></p> 
<p><span>Примечание</span></p> 
<p><span>Реального распределения памяти под массив данных и копирования не происходит. При обращении к такому массиву производится перенаправление доступа. Исключение составляют массивы, назначенные в качестве индексных в пользовательских индикаторах. В этом случае производится реальное копирование данных.</span></p> 
<p><span>Замечание: если series_index - MODE_TIME, то передаваемый в функцию массив должен иметь тип datetime[].</span></p> 
<p><span style="font-weight: bold;">Пример:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">datetime</span><span>&nbsp;daytimes[];</span><br> <span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shift=10,dayshift,error;</span><br> <span style="color: #808080;">//----&nbsp;массив&nbsp;Time[]&nbsp;отсортирован&nbsp;в&nbsp;порядке&nbsp;убывания</span><br> <span style="color: #0000ff;">ArrayCopySeries</span><span>(daytimes,MODE_TIME,</span><span style="color: #0000ff;">Symbol</span><span>(),</span><span style="color: #0000ff;">PERIOD_D1</span><span>);</span><br> <span>error=</span><span style="color: #0000ff;">GetLastError</span><span>();</span><br> <span style="color: #0000ff;">if</span><span>(error==4066)</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//----&nbsp;делаем&nbsp;еще&nbsp;2&nbsp;попытки&nbsp;чтения</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;i=0;i&lt;2;&nbsp;i++)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Sleep</span><span>(5000);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayCopySeries</span><span>(daytimes,MODE_TIME,</span><span style="color: #0000ff;">Symbol</span><span>(),</span><span style="color: #0000ff;">PERIOD_D1</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//----&nbsp;проверим&nbsp;время&nbsp;текущего&nbsp;дневного&nbsp;бара</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&nbsp;last_day=daytimes[0];</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">Year</span><span>()==</span><span style="color: #0000ff;">TimeYear</span><span>(last_day)&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000ff;">Month</span><span>()==</span><span style="color: #0000ff;">TimeMonth</span><span>(last_day)&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000ff;">Day</span><span>()==</span><span style="color: #0000ff;">TimeDay</span><span>(last_day))&nbsp;</span><span style="color: #0000ff;">break</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">Time</span><span>[shift]&gt;=daytimes[0])&nbsp;dayshift=0;</span><br> <span style="color: #0000ff;">else</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;dayshift=</span><span style="color: #0000ff;">ArrayBsearch</span><span>(daytimes,</span><span style="color: #0000ff;">Time</span><span>[shift],</span><span style="color: #0000ff;">WHOLE_ARRAY</span><span>,0,MODE_DESCEND);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">Period</span><span>()&lt;</span><span style="color: #0000ff;">PERIOD_D1</span><span>)&nbsp;dayshift++;</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #0000ff;">Print</span><span>(</span><span style="color: #0000ff;">TimeToStr</span><span>(</span><span style="color: #0000ff;">Time</span><span>[shift]),</span><span style="color: #008080;">"&nbsp;corresponds&nbsp;to&nbsp;"</span><span>,dayshift,</span><span style="color: #008080;">"&nbsp;day&nbsp;bar&nbsp;opened&nbsp;at&nbsp;"</span><span>,&nbsp;</span><span style="color: #0000ff;">TimeToStr</span><span>(daytimes[dayshift]));</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<br>