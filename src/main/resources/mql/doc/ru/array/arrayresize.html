<h1>ArrayResize</h1> 
<p><span>Устанавливает новый размер в первом измерении массива</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>int&nbsp;&nbsp;</span><span>ArrayResize</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>void&amp;</span><span>&nbsp;&nbsp;</span><span>array[]</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;массив,&nbsp;переданный&nbsp;по&nbsp;ссылке</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>new_size</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;новый&nbsp;размер&nbsp;массива</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>reserve_size=0&nbsp;&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;резервное&nbsp;значение&nbsp;размера&nbsp;(избыточное)</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Параметры</span></p> 
<p><span>array[]</span></p> 
<p><span>[out] &nbsp;Массив для изменения размеров.</span></p> 
<p><span>new_size</span></p> 
<p><span>[in] &nbsp;Новый размер для первого измерения.</span></p> 
<p><span>reserve_size=0</span></p> 
<p><span>[in] &nbsp;Необязательный параметр. Размер для дополнительного резерва.</span></p> 
<p><span>Возвращаемое значение</span></p> 
<p><span>При успешном выполнении функция возвращает количество всех элементов, содержащихся в массиве после изменения размера; в противном случае возвращает -1 и массив не меняет размеры.</span></p> 
<p><span>Примечание</span></p> 
<p><span>Функция может быть применена только к <a href="/basis/types/dynamic_array">динамическим&nbsp;массивам</a>. При этом необходимо иметь ввиду, что нельзя изменять размер для динамических массивов, назначенных в качестве индикаторных буферов функцией <a href="/customind/setindexbuffer">SetIndexBuffer()</a>. Для индикаторных буферов все операции по изменению размера производит исполняющая подсистема терминала.</span></p>
<p><span>Общее число элементов в массиве не может превышать 2147483647.</span></p> 
<p><span>При частом распределении памяти рекомендуется использовать третий параметр, задающий резерв для уменьшения количества физического распределения памяти. Все последующие вызовы функции </span><span style="color: #0000ff;">ArrayResize</span><span> не приводят к физическому перераспределению памяти, а только меняется размер первого измерения массива в пределах зарезервированной памяти. Следует помнить, что третий параметр будет использоваться только тогда, когда будет происходить физическое распределение памяти, например:</span></p> 
<div style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 8px 17px 4px 30px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">ArrayResize</span><span>(arr,1000,1000);</span><br> <span style="color: #0000ff;">for</span><span>(int&nbsp;i=1;i&lt;3000;i++)</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(arr,i,1000);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>В данном случае произойдёт 2 перераспределения памяти, один раз до входа в цикл на 2000 элементов, при этом размерность массива будет установлена в 1000 и второй при i равной 2000. Если третий параметр опустить, то произойдёт 2000 физических перераспределения памяти и это замедлит выполнение программы.</span></p> 
<p><span style="font-weight: bold;">Пример:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Script&nbsp;program&nbsp;start&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnStart</span><span>()</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---&nbsp;счетчики</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ulong</span><span>&nbsp;start=</span><span style="color: #0000ff;">GetTickCount</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ulong</span><span>&nbsp;now;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;count=0;</span><br> <span style="color: #808080;">//---&nbsp;массив&nbsp;для&nbsp;демонстрации&nbsp;быстрого&nbsp;варианта</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;arr[];</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(arr,100000,100000);</span><br> <span style="color: #808080;">//---&nbsp;проверим,&nbsp;как&nbsp;быстро&nbsp;работает&nbsp;вариант&nbsp;с&nbsp;резервированием&nbsp;памяти&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"---&nbsp;Test&nbsp;Fast:&nbsp;ArrayResize(arr,100000,100000)"</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;i=1;i&lt;=300000;i++)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;задаем&nbsp;новый&nbsp;размер&nbsp;массива&nbsp;с&nbsp;указанием&nbsp;резерва&nbsp;в&nbsp;100000&nbsp;элементов!</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(arr,i,100000);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;при&nbsp;достижении&nbsp;круглой&nbsp;цифры&nbsp;выводим&nbsp;размер&nbsp;массива&nbsp;и&nbsp;затраченное&nbsp;время</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">ArraySize</span><span>(arr)%100000==0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now=</span><span style="color: #0000ff;">GetTickCount</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count++;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">PrintFormat</span><span>(</span><span style="color: #008080;">"%d.&nbsp;ArraySize(arr)=%d&nbsp;Time=%d&nbsp;ms"</span><span>,count,</span><span style="color: #0000ff;">ArraySize</span><span>(arr),(now-start));</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start=now;&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;покажем&nbsp;теперь,&nbsp;как&nbsp;медленно&nbsp;работает&nbsp;вариант&nbsp;без&nbsp;резервирования&nbsp;памяти&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;slow[];</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(slow,100000,100000);</span><br> <span style="color: #808080;">//---&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;count=0;</span><br> <span>&nbsp;&nbsp;&nbsp;start=</span><span style="color: #0000ff;">GetTickCount</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"----&nbsp;Test&nbsp;Slow:&nbsp;ArrayResize(slow,100000)"</span><span>);</span><br> <span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;i=1;i&lt;=300000;i++)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;задаем&nbsp;новый&nbsp;размер&nbsp;массива,&nbsp;но&nbsp;уже&nbsp;без&nbsp;дополнительного&nbsp;резерва</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(slow,i);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;при&nbsp;достижении&nbsp;круглой&nbsp;цифры&nbsp;выводим&nbsp;размер&nbsp;массива&nbsp;и&nbsp;затраченное&nbsp;время</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">ArraySize</span><span>(slow)%100000==0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now=</span><span style="color: #0000ff;">GetTickCount</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count++;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">PrintFormat</span><span>(</span><span style="color: #008080;">"%d.&nbsp;ArraySize(slow)=%d&nbsp;Time=%d&nbsp;ms"</span><span>,count,</span><span style="color: #0000ff;">ArraySize</span><span>(slow),(now-start));</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start=now;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;Примерный&nbsp;результат&nbsp;выполнения&nbsp;скрипта</span><br> <span>/*</span><br> <span>&nbsp;&nbsp;&nbsp;Test_ArrayResize&nbsp;(EURUSD,H1)&nbsp;&nbsp;&nbsp;---&nbsp;Test&nbsp;Fast:&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(arr,100000,100000)</span><br> <span>&nbsp;&nbsp;&nbsp;Test_ArrayResize&nbsp;(EURUSD,H1)&nbsp;&nbsp;&nbsp;1.&nbsp;</span><span style="color: #0000ff;">ArraySize</span><span>(arr)=100000&nbsp;Time=0&nbsp;ms</span><br> <span>&nbsp;&nbsp;&nbsp;Test_ArrayResize&nbsp;(EURUSD,H1)&nbsp;&nbsp;&nbsp;2.&nbsp;</span><span style="color: #0000ff;">ArraySize</span><span>(arr)=200000&nbsp;Time=0&nbsp;ms</span><br> <span>&nbsp;&nbsp;&nbsp;Test_ArrayResize&nbsp;(EURUSD,H1)&nbsp;&nbsp;&nbsp;3.&nbsp;</span><span style="color: #0000ff;">ArraySize</span><span>(arr)=300000&nbsp;Time=0&nbsp;ms</span><br> <span>&nbsp;&nbsp;&nbsp;Test_ArrayResize&nbsp;(EURUSD,H1)&nbsp;&nbsp;&nbsp;----&nbsp;Test&nbsp;Slow:&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(slow,100000)</span><br> <span>&nbsp;&nbsp;&nbsp;Test_ArrayResize&nbsp;(EURUSD,H1)&nbsp;&nbsp;&nbsp;1.&nbsp;</span><span style="color: #0000ff;">ArraySize</span><span>(slow)=100000&nbsp;Time=0&nbsp;ms</span><br> <span>&nbsp;&nbsp;&nbsp;Test_ArrayResize&nbsp;(EURUSD,H1)&nbsp;&nbsp;&nbsp;2.&nbsp;</span><span style="color: #0000ff;">ArraySize</span><span>(slow)=200000&nbsp;Time=0&nbsp;ms</span><br> <span>&nbsp;&nbsp;&nbsp;Test_ArrayResize&nbsp;(EURUSD,H1)&nbsp;&nbsp;&nbsp;3.&nbsp;</span><span style="color: #0000ff;">ArraySize</span><span>(slow)=300000&nbsp;Time=228511&nbsp;ms</span><br> <span>*/</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Смотри также</span></p> 
<p><span><a href="/array/arrayinitialize">ArrayInitialize</a></span></p>
<br>