<h1>Макроподстановка (#define, #undef)</h1> 
<p><span>Директива #define может быть использована для присвоения мнемонических имен выражениям. Существует две формы:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">#define</span><span>&nbsp;identifier&nbsp;expression&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;беспараметрическая&nbsp;форма</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;identifier(par1,...&nbsp;par8)&nbsp;expression&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;параметрическая&nbsp;форма</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Директива #define подставляет expression вместо всех последующих найденных вхождений identifier в исходном тексте. identifier заменяется только в том случае, если он представляет собой отдельный токен. identifier не заменяется, если он является частью комментария, частью строки, или частью другого более длинного идентификатора.</span></p> 
<p><span>Идентификатор константы подчиняется тем же правилам, что и для имен переменных. Значение может быть любого типа:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">#define</span><span>&nbsp;ABC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;PI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.14</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;COMPANY_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008080;">"MetaQuotes&nbsp;Software&nbsp;Corp."</span><br> <span>...</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;ShowCopyright()</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Copyright&nbsp;&nbsp;2001-2009,&nbsp;"</span><span>,COMPANY_NAME);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"http://www.metaquotes.net"</span><span>);</span><br> <span>&nbsp;&nbsp;}</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>expression может состоять из нескольких токенов, таких как ключевые слова, константы, константные и неконстантные выражения. expression заканчивается с концом строки и не может быть перенесено на следующую строку.</span></p> 
<p><span style="font-weight: bold;">Пример</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">#define</span><span>&nbsp;TWO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;THREE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;INCOMPLETE&nbsp;TWO+THREE</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;COMPLETE&nbsp;&nbsp;(TWO+THREE)</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;OnStart()</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"2&nbsp;+&nbsp;3*2&nbsp;=&nbsp;"</span><span>,INCOMPLETE*2);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"(2&nbsp;+&nbsp;3)*2&nbsp;=&nbsp;"</span><span>,COMPLETE*2);</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">/*&nbsp;Результат</span><br> <span style="color: #808080;">&nbsp;&nbsp;&nbsp;2&nbsp;+&nbsp;3*2&nbsp;=&nbsp;8</span><br> <span style="color: #808080;">&nbsp;&nbsp;&nbsp;(2&nbsp;+&nbsp;3)*2&nbsp;=&nbsp;10</span><br> <span style="color: #808080;">*/</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>&nbsp;</span></p> 
<h3>Параметрическая форма #define</h3> 
<p><span>При параметрической форме все последующие найденные вхождения identifier будут заменены на expression с учетом фактических параметров. Например,</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>&nbsp;</span><span style="color: #808080;">//&nbsp;пример&nbsp;с&nbsp;двумя&nbsp;параметрами&nbsp;a&nbsp;и&nbsp;b</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;A&nbsp;2+3</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;B&nbsp;5-1</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;MUL(a,&nbsp;b)&nbsp;((a)*(b))</span><br> <span>&nbsp;</span><br> <span style="color: #0000ff;">double</span><span>&nbsp;c=MUL(A,B);</span><br> <span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"c="</span><span>,c);</span><br> <span style="color: #787771;">/*</span><br> <span style="color: #787771;">выражение&nbsp;double&nbsp;c=MUL(A,B);</span><br> <span style="color: #787771;">равносильно&nbsp;double&nbsp;c=((2+3)*(5-1));</span><br> <span style="color: #787771;">*/</span><br> <span style="color: #808080;">//&nbsp;Результат</span><br> <span style="color: #808080;">//&nbsp;c=20</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Обязательно заключайте параметры в круглые скобки при использовании параметров в expression, так как это позволит избежать неочевидных ошибок, которые трудно найти. Если переписать пример без использования скобок, то результат окажется совсем другой:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>&nbsp;</span><span style="color: #808080;">//&nbsp;пример&nbsp;с&nbsp;двумя&nbsp;параметрами&nbsp;a&nbsp;и&nbsp;b</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;A&nbsp;2+3</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;B&nbsp;5-1</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;MUL(a,&nbsp;b)&nbsp;a*b</span><br> <span>&nbsp;</span><br> <span style="color: #0000ff;">double</span><span>&nbsp;c=MUL(A,B);</span><br> <span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"c="</span><span>,c);</span><br> <span style="color: #787771;">/*</span><br> <span style="color: #787771;">выражение&nbsp;double&nbsp;c=MUL(A,B);</span><br> <span style="color: #787771;">равносильно&nbsp;double&nbsp;c=2+3*5-1;</span><br> <span style="color: #787771;">*/</span><br> <span style="color: #808080;">//&nbsp;Результат</span><br> <span style="color: #808080;">//&nbsp;c=16</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>При использовании параметрической формы допускается не более 8 параметров. </span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>&nbsp;</span><span style="color: #808080;">//&nbsp;правильная&nbsp;параметрическая&nbsp;форма</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;</span><span style="color: #0000ff;">LOG</span><span>(text)&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #0000ff;">__FILE__</span><span>,</span><span style="color: #008080;">"("</span><span>,</span><span style="color: #0000ff;">__LINE__</span><span>,</span><span style="color: #008080;">")&nbsp;:"</span><span>,text)&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;один&nbsp;параметр&nbsp;-&nbsp;'text'</span><br> <span>&nbsp;</span><br> <span>&nbsp;</span><span style="color: #808080;">//&nbsp;неправильная&nbsp;параметрическая&nbsp;форма&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br> <span style="color: #0000ff;">#define</span><span>&nbsp;WRONG_DEF(p1,&nbsp;p2,&nbsp;p3,&nbsp;p4,&nbsp;p5,&nbsp;p6,&nbsp;p7,&nbsp;p8,&nbsp;p9)&nbsp;&nbsp;&nbsp;p1+p2+p3+p4&nbsp;</span><span style="color: #808080;">//&nbsp;более&nbsp;8&nbsp;параметров&nbsp;от&nbsp;p1&nbsp;до&nbsp;p9</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<h3>&nbsp;</h3> 
<h3>Директива #undef</h3> 
<p><span>Директива #undef предназначена для отмены макроса, объявленного ранее.</span></p> 
<p><span style="font-weight: bold;">Пример:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">#define</span><span>&nbsp;MACRO</span><br> <span>&nbsp;</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;func1()</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #0000ff;">#ifdef</span><span>&nbsp;MACRO</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"MACRO&nbsp;is&nbsp;defined&nbsp;in&nbsp;"</span><span>,</span><span style="color: #0000ff;">__FUNCTION__</span><span>);&nbsp;&nbsp;&nbsp;</span><br> <span style="color: #0000ff;">#else</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"MACRO&nbsp;is&nbsp;not&nbsp;defined&nbsp;in&nbsp;"</span><span>,</span><span style="color: #0000ff;">__FUNCTION__</span><span>);</span><br> <span style="color: #0000ff;">#endif</span><br> <span>&nbsp;&nbsp;}</span><br> <span>&nbsp;</span><br> <span style="color: #0000ff;">#undef</span><span>&nbsp;MACRO</span><br> <span>&nbsp;</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;func2()</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #0000ff;">#ifdef</span><span>&nbsp;MACRO</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"MACRO&nbsp;is&nbsp;defined&nbsp;in&nbsp;"</span><span>,</span><span style="color: #0000ff;">__FUNCTION__</span><span>);</span><br> <span style="color: #0000ff;">#else</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"MACRO&nbsp;is&nbsp;not&nbsp;defined&nbsp;in&nbsp;"</span><span>,</span><span style="color: #0000ff;">__FUNCTION__</span><span>);</span><br> <span style="color: #0000ff;">#endif</span><br> <span>&nbsp;&nbsp;}</span><br> <span>&nbsp;</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnStart</span><span>()</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;func1();</span><br> <span>&nbsp;&nbsp;&nbsp;func2();</span><br> <span>&nbsp;&nbsp;}</span><br> <span>&nbsp;</span><br> <span style="color: #808080;">/*&nbsp;Результат:</span><br> <span style="color: #808080;">&nbsp;MACRO&nbsp;is&nbsp;defined&nbsp;in&nbsp;func1</span><br> <span style="color: #808080;">&nbsp;MACRO&nbsp;is&nbsp;not&nbsp;defined&nbsp;in&nbsp;func2</span><br> <span style="color: #808080;">*/</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Смотри также</span></p> 
<p><span><a href="/basis/syntax/identifiers">Идентификаторы</a>, <a href="/basis/types/integer/symbolconstants">Символьные константы</a></span></p>
<br>