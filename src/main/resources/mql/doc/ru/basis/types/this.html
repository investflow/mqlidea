<h1>Ссылки. Модификатор &amp; и ключевое слово this</h1> 
<h2>Передача параметров по ссылке</h2> 
<p><span>В MQL4 параметры <a href="/basis/types#base_types">простых</a> типов можно передавать как по значению, так и по ссылке, в то время как параметры <a href="/basis/types#complex_types">сложных</a> типов всегда передаются по ссылке. Для указания компилятору на необходимость передачи параметра по ссылке, перед именем параметра ставится знак амперсанда </span><span style="font-family: Tahoma,Geneva,Verdana,sans-serif; font-weight: bold;">&amp;</span><span style="font-family: Tahoma,Geneva,Verdana,sans-serif;">.</span><span> </span></p>
<p><span>Передача параметра по ссылке означает передачу адреса переменной, поэтому все изменения, произведенные над переданным по ссылке параметром, сразу же отобразятся и в исходной переменной. Используя передачу параметров по ссылке можно организовать возврат одновременно нескольких результатов из функции. Чтобы предотвратить изменение переданного по ссылке параметра, необходимо использовать модификатор <a href="/basis/variables#const">const</a>.</span></p>
<p><span>Таким образом, если входной параметр функции является <a href="/basis/variables#array_define">массивом</a>, объектом структуры или класса, то в заголовке функции после типа переменной и перед ее именем ставится символ '</span><span style="font-family: Tahoma,Geneva,Verdana,sans-serif;">&amp;</span><span>'.</span></p>
<p><span style="font-weight: bold;">Пример</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">class</span><span>&nbsp;CDemoClass</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #0000ff;">private</span><span>:</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_array[];</span><br> <span>&nbsp;</span><br> <span style="color: #0000ff;">public</span><span>:</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">void</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setArray(</span><span style="color: #0000ff;">double</span><span>&nbsp;&amp;array[]);</span><br> <span>&nbsp;&nbsp;};</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;заполнение&nbsp;массива&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;&nbsp;CDemoClass::setArray(</span><span style="color: #0000ff;">double</span><span>&nbsp;&amp;array[])</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">ArraySize</span><span>(array)&gt;0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(m_array,</span><span style="color: #0000ff;">ArraySize</span><span>(array));</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayCopy</span><span>(m_array,&nbsp;array);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;}</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>В вышеприведенном примере объявлен <a href="/basis/types/classes#class">класс</a> CDemoClass, который содержит <a href="/basis/variables#private">приватный</a> член - массив m_array[] типа <a href="/basis/types/double">double</a>. Объявлена <a href="/basis/function">функция</a> setArray(), в которую по ссылке передается массив array[]. Если заголовок функции написать без указания передачи по ссылке, т.е. убрать знак амперсанда, то при попытке компиляции такого кода будет выдано сообщение об ошибке.</span></p>
<p><span>Несмотря на то, что массив передается по ссылке, мы не можем произвести присвоение одного массива другому. Необходимо сделать поэлементное копирование содержимого массива-источника в массив-приемник. Наличие символа </span><span style="font-family: Tahoma,Geneva,Verdana,sans-serif;">&amp;</span><span> для массивов и структур при передаче в качестве параметра функции является обязательным при описании функции.</span></p> 
<h2>Ключевое слово this</h2> 
<p><span>Переменная типа класса (объект) может передаваться как по ссылке, так и по <a href="/basis/types/object_pointers">указателю</a>. Указатель как и ссылка служит для того чтобы получать доступ к объекту. После объявления указателя объекта необходимо применить к нему оператор <a href="/basis/operators/newoperator">new</a> для его создания и инициализации.</span></p>
<p><span>Зарезервированное слово </span><span style="font-weight: bold;">this</span><span> предназначено для получения ссылки объекта на самого себя, доступной внутри методов класса или структуры. </span><span style="font-weight: bold;">this</span><span> всегда ссылается на объект, в методе которого используется, а выражение <a href="/common/getpointer">GetPointer</a>(this) даёт указатель объекта, членом которого является функция, в которой осуществлен вызов функции GetPointer(). В MQL4 функции не могут возвращать объекты, но разрешено возвращать указатель объекта. </span></p>
<p><span>Таким образом, если необходимо, чтобы функция вернула объект, то мы можем вернуть указатель этого объекта в виде &nbsp;GetPointer(this). Добавим в описание класса CDemoClass функцию getDemoClass(), которая возвращает указатель объекта этого класса.</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">class</span><span>&nbsp;CDemoClass</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #0000ff;">private</span><span>:</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_array[];</span><br> <span>&nbsp;</span><br> <span style="color: #0000ff;">public</span><span>:</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">void</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setArray(</span><span style="color: #0000ff;">double</span><span>&nbsp;&amp;array[]);</span><br> <span>&nbsp;&nbsp;&nbsp;CDemoClass&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*getDemoClass();</span><br> <span>&nbsp;&nbsp;};</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;заполнение&nbsp;массива&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;&nbsp;CDemoClass::setArray(</span><span style="color: #0000ff;">double</span><span>&nbsp;&amp;array[])</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">ArraySize</span><span>(array)&gt;0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(m_array,</span><span style="color: #0000ff;">ArraySize</span><span>(array));</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayCopy</span><span>(m_array,array);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;возвращает&nbsp;собственный&nbsp;указатель&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span>CDemoClass&nbsp;*CDemoClass::getDemoClass(</span><span style="color: #0000ff;">void</span><span>)</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">GetPointer</span><span>(</span><span style="color: #0000ff;">this</span><span>));</span><br> <span>&nbsp;&nbsp;}</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Структуры не имеют указателей, к ним нельзя применять операторы </span><span style="font-style: italic;">new</span><span> и </span><span style="font-style: italic;">delete,</span><span> и нельзя использовать GetPointer(this)</span><span style="font-style: italic;">.</span><span> </span></p> 
<p><span>Смотри также</span></p> 
<p><span><a href="/basis/types/object_pointers">Указатели объектов</a>, <a href="/basis/variables/object_live">Создание и уничтожение объектов</a>, <a href="/basis/variables/variable_scope">Область видимости и время жизни переменных</a></span></p>
<br>