<h1>Перегрузка функций</h1> 
<p><span>Обычно в названии функции стремятся отобразить ее основное назначение. Читабельные программы, как правило, содержат разнообразные и грамотно подобранные <a href="/basis/syntax/identifiers">идентификаторы</a>. Иногда различные функции используются для одних и тех же целей. Например, рассмотрим функцию, которая вычисляет среднее значение массива чисел двойной точности, и такую же функцию, но оперирующую массивом целых чисел. И ту, и другую удобно назвать AverageFromArray:</span></p>
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;вычисление&nbsp;среднего&nbsp;для&nbsp;массива&nbsp;типа&nbsp;double&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">double</span><span>&nbsp;AverageFromArray(</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&amp;&nbsp;array[],</span><span style="color: #0000ff;">int</span><span>&nbsp;size)</span><br> <span>&nbsp;&nbsp;{&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(size&lt;=0)&nbsp;</span><span style="color: #0000ff;">return</span><span>&nbsp;0.0;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;sum=0.0;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;aver;</span><br> <span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;i=0;i&lt;size;i++)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sum+=array[i];&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;сложение&nbsp;для&nbsp;double</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;aver=sum/size;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;просто&nbsp;делим&nbsp;сумму&nbsp;на&nbsp;количество</span><br> <span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Вычисление&nbsp;среднего&nbsp;для&nbsp;массива&nbsp;типа&nbsp;double"</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>&nbsp;aver;</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;вычисление&nbsp;среднего&nbsp;для&nbsp;массива&nbsp;типа&nbsp;int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">double</span><span>&nbsp;AverageFromArray(</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&amp;&nbsp;array[],</span><span style="color: #0000ff;">int</span><span>&nbsp;size)</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(size&lt;=0)&nbsp;</span><span style="color: #0000ff;">return</span><span>&nbsp;0.0;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;aver=0.0;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;sum=0;</span><br> <span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;i=0;i&lt;size;i++)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sum+=array[i];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;сложение&nbsp;для&nbsp;int</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;aver=(</span><span style="color: #0000ff;">double</span><span>)sum/size;</span><span style="color: #808080;">//&nbsp;приведем&nbsp;сумму&nbsp;к&nbsp;типу&nbsp;double&nbsp;и&nbsp;разделим</span><br> <span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Вычисление&nbsp;среднего&nbsp;для&nbsp;массива&nbsp;типа&nbsp;int"</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>&nbsp;aver;</span><br> <span>&nbsp;&nbsp;}</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Каждая функция содержит вывод сообщения посредством функции <a href="/common/print">Print()</a>;</span></p>
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Вычисление&nbsp;среднего&nbsp;для&nbsp;массива&nbsp;типа&nbsp;int"</span><span>);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Компилятор выбирает нужную функцию в соответствии с типами аргументов и их количеством. Правило, по которому осуществляется этот выбор, называется </span><span style="font-style: italic;">алгоритмом соответствия сигнатуре</span><span>. Под сигнатурой понимается список типов, который используется в объявлении функции.</span></p> 
<p><span style="font-weight: bold;">Пример:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Script&nbsp;program&nbsp;start&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnStart</span><span>()</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;a[5]={1,2,3,4,5};</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;b[5]={1.1,2.2,3.3,4.4,5.5};</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;int_aver=AverageFromArray(a,5);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;double_aver=AverageFromArray(b,5);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"int_aver&nbsp;=&nbsp;"</span><span>,int_aver,</span><span style="color: #008080;">"&nbsp;&nbsp;&nbsp;double_aver&nbsp;=&nbsp;"</span><span>,double_aver);</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;Результат&nbsp;работы&nbsp;скрипта</span><br> <span style="color: #808080;">//&nbsp;Вычисление&nbsp;среднего&nbsp;для&nbsp;массива&nbsp;типа&nbsp;int</span><br> <span style="color: #808080;">//&nbsp;Вычисление&nbsp;среднего&nbsp;для&nbsp;массива&nbsp;типа&nbsp;double</span><br> <span style="color: #808080;">//&nbsp;int_aver=&nbsp;3.00000000&nbsp;&nbsp;&nbsp;&nbsp;double_aver=&nbsp;3.30000000</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Перегрузка функций – это создание нескольких функций с одним именем, но с разными параметрами. Это означает, что в перегружаемых вариантах функции разным должно быть количество аргументов и/или их тип. Выбор конкретного варианта функции зависит от типов аргументов, полученных функцией. Конкретная функция выбирается в зависимости от соответствия списка аргументов при вызове функции списку параметров в объявлении функции.</span></p> 
<p><span>Когда вызывается перегруженная функция, компилятор должен иметь алгоритм для выбора надлежащей функции. Алгоритм, который выполняет этот выбор, зависит от того, <a href="/basis/types/casting">преобразования</a> какого типа присутствуют. Наилучшее соответствие должно быть уникальным. Найденная функция должна быть наилучшим выбором среди остальных вариантов хотя бы по одному аргументу, и, в то же время, по остальным аргументам она должна подходить не хуже остальных.</span></p>
<p><span>Ниже приведен алгоритм соответствия для каждого аргумента.</span></p> 
<h2>Алгоритм выбора перегруженной функции</h2> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 20px; margin: 2px 17px 3px 17px;"><span style="font-size:10pt; font-family: 'Trebuchet MS';color:#565656;display:inline-block;width:20px;margin-left:-20px">1.</span><span>Использовать строгое соответствие (если это возможно).</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 20px; margin: 2px 17px 3px 17px;"><span style="font-size:10pt; font-family: 'Trebuchet MS';color:#565656;display:inline-block;width:20px;margin-left:-20px">2.</span><span>Попробовать стандартное повышение типа.</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 20px; margin: 2px 17px 3px 17px;"><span style="font-size:10pt; font-family: 'Trebuchet MS';color:#565656;display:inline-block;width:20px;margin-left:-20px">3.</span><span>Попробовать стандартное преобразование типа.</span></p> 
<p><span>Стандартное повышение типа лучше, чем остальные стандартные преобразования. Повышение - это преобразование </span><span style="color: #0000ff;">float</span><span> в </span><span style="color: #0000ff;">double</span><span>, а также </span><span style="color: #0000ff;">bool</span><span>, </span><span style="color: #0000ff;">char</span><span>, </span><span style="color: #0000ff;">short</span><span> или </span><span style="color: #0000ff;">enum</span><span> в </span><span style="color: #0000ff;">int</span><span>. Кроме того, к стандартным преобразованиям относятся преобразования массивов похожих <a href="/basis/types/integer">целых&nbsp;типов</a>. Похожими типами являются: bool, char, uchar, так как все три типа являются однобайтовыми целыми; двубайтовые целые short и ushort; 4-байтовые целые int, uint и color; long, ulong и datetime.</span></p>
<p><span>Несомненно, строгое соответствие является наилучшим. Для достижения такого соответствия могут использоваться <a href="/basis/types/casting">приведения</a>. Компилятор не справится с двусмысленной ситуацией. Поэтому не следует полагаться на тонкие различия в типах и неявные преобразования, которые делают перегруженную функцию неясной. </span></p>
<p><span>Если вы сомневаетесь, используйте явные преобразования для обеспечения строгого соответствия.</span></p> 
<p><span>Примеры перегруженных функций в MQL4 вы можете увидеть на примере функций <a href="/array/arrayinitialize">ArrayInitialize()</a>.</span></p>
<p><span>Правила перегрузки функций применимы к <a href="/basis/oop/overload">перегрузке&nbsp;методов&nbsp;классов</a>.</span></p>
<p><span>&nbsp;</span></p> 
<p><span>Перегрузка системных функций допускается, но при этом следует следить за тем, чтобы компилятор точно мог выбрать нужную функцию. Для примера, мы можем перегрузить системную функцию <a href="/math/mathmax">MathMax()</a> 4-мя различными способами, но только два варианта будут корректными.</span></p>
<p><span style="font-weight: bold;">Пример:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #808080;">//&nbsp;1.&nbsp;перегрузка&nbsp;допустима&nbsp;-&nbsp;функция&nbsp;отличается&nbsp;от&nbsp;встроенной&nbsp;в&nbsp;язык&nbsp;MathMax()&nbsp;по&nbsp;количеству&nbsp;параметров</span><br> <span style="color: #0000ff;">double</span><span>&nbsp;</span><span style="color: #0000ff;">MathMax</span><span>(</span><span style="color: #0000ff;">double</span><span>&nbsp;a,</span><span style="color: #0000ff;">double</span><span>&nbsp;b,</span><span style="color: #0000ff;">double</span><span>&nbsp;c);</span><br> <span>&nbsp;</span><br> <span style="color: #808080;">//&nbsp;2.&nbsp;перегрузка&nbsp;недопустима!</span><br> <span style="color: #808080;">//&nbsp;количество&nbsp;параметров&nbsp;разное,&nbsp;но&nbsp;последний&nbsp;имеет&nbsp;значение&nbsp;по&nbsp;умолчанию</span><br> <span style="color: #808080;">//&nbsp;это&nbsp;приводит&nbsp;к&nbsp;сокрытию&nbsp;системной&nbsp;функции&nbsp;при&nbsp;вызове,&nbsp;что&nbsp;недопустимо</span><br> <span style="color: #0000ff;">double</span><span>&nbsp;</span><span style="color: #0000ff;">MathMax</span><span>(</span><span style="color: #0000ff;">double</span><span>&nbsp;a,</span><span style="color: #0000ff;">double</span><span>&nbsp;b,</span><span style="color: #0000ff;">double</span><span>&nbsp;c=</span><span style="color: #0000ff;">DBL_MIN</span><span>);</span><br> <span>&nbsp;</span><br> <span style="color: #808080;">//&nbsp;3.&nbsp;перегрузка&nbsp;допустима&nbsp;-&nbsp;нормальная&nbsp;перегрузка&nbsp;по&nbsp;типу&nbsp;параметров&nbsp;a&nbsp;и&nbsp;b</span><br> <span style="color: #0000ff;">int</span><span>&nbsp;</span><span style="color: #0000ff;">MathMax</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;a,</span><span style="color: #0000ff;">int</span><span>&nbsp;b);</span><br> <span>&nbsp;</span><br> <span style="color: #808080;">//&nbsp;4.&nbsp;перегрузка&nbsp;недопустима!</span><br> <span style="color: #808080;">//&nbsp;количество&nbsp;и&nbsp;тип&nbsp;параметров&nbsp;не&nbsp;отличается&nbsp;от&nbsp;исходной&nbsp;double&nbsp;MathMax(double&nbsp;a,double&nbsp;b)</span><br> <span style="color: #0000ff;">int</span><span>&nbsp;</span><span style="color: #0000ff;">MathMax</span><span>(</span><span style="color: #0000ff;">double</span><span>&nbsp;a,</span><span style="color: #0000ff;">double</span><span>&nbsp;b);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Смотри также</span></p> 
<p><span><a href="/basis/oop/overload">Перегрузка</a>, <a href="/basis/oop/virtual">Виртуальные функции</a>, <a href="/basis/oop/polymorphism">Полиморфизм</a></span></p>
<br>