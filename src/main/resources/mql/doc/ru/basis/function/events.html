<h1>Функции обработки событий</h1> 
<p><span>В языке MQL4 предусмотрена обработка некоторых <a href="/runtime/event_fire">предопределенных&nbsp;событий</a>. Функции для обработки этих событий должны быть определены в программе MQL4: имя функции, тип возвращаемого значения, состав параметров (если они есть) и их типы должны строго соответствовать описанию функции-обработчика события.</span></p>
<p><span>Именно по типу возвращаемого значения и по типам параметров обработчик событий клиентского терминала идентифицирует функции, обрабатывающие то или иное событие. Если у соответствующей функции указаны иные, не соответствующие нижеследующим описаниям, параметры или указан иной тип возвращаемого значения, то такая функция не будет использоваться для обработки события.</span></p> 
<h3><a id="onstart"></a>OnStart</h3> 
<p><span>Функция OnStart() является обработчиком события <a href="/runtime/event_fire#start">Start</a>, которое автоматически генерируется </span><span style="font-weight: bold;">только</span><span> для запущенных на выполнение </span><span style="font-weight: bold;">скриптов</span><span>. Должна иметь тип </span><span style="color: #0000ff;">void</span><span>, параметров не имеет:</span></p>
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnStart</span><span>();</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span> Для функции OnStart() допустимо указывать тип возвращаемого значения int.</span></p> 
<h3><a id="oninit"></a>OnInit</h3> 
<p><span>Функция OnInit() является обработчиком события <a href="/runtime/event_fire#init">Init</a>. Может иметь тип </span><span style="color: #0000ff;">void </span><span>или </span><span style="color: #0000ff;">int</span><span>, параметров не имеет:</span></p>
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnInit</span><span>();</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Событие Init генерируется сразу после загрузки эксперта или индикатора. Функция OnInit() используется для инициализации. Если OnInit() имеет возвращаемое значение типа int, то ненулевой код возврата означает неудачную инициализацию и генерирует событие <a href="/runtime/event_fire#deinit">Deinit</a> с кодом причины деинициализации </span><span><a href="/constants/namedconstants/uninit#reason_initfailed">REASON_INITFAILED</a></span><span>.</span></p>
<p><span>Результат выполнения функции OnInit() анализируется исполняющей подсистемой терминала только в том случае, если программа скомпилирована с использованием <a href="/mql4changes#compiler_difference">#property strict</a>.</span></p>
<p><span>Для оптимизации входных параметров эксперта рекомендуется в качестве кода возврата использовать значения из перечисления <a href="/basis/function/events#enum_init_retcode">ENUM_INIT_RETCODE</a>. Эти значения предназначены для организации управления ходом оптимизации. Прямо при инициализации эксперта еще до запуска самого тестирования можно запросить информацию о конфигурации и ресурсах с помощью функции <a href="/check/terminalinfointeger">TerminalInfoInteger()</a>.</span></p>
<p><a id="enum_init_retcode"></a><span style="font-weight: bold;">ENUM_INIT_RETCODE</span></p> 
<div style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 8px 17px 7px 17px;"> 
 <table cellpadding="5" border="1" style="border:solid 2px #b1c2d6; border-spacing:0px; border-collapse:collapse;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; width:200px; background-color:#dbe9f9; padding:5px; border:solid thin #b1c2d6;"><p><span>Идентификатор</span></p> </td> 
    <td style="vertical-align:top; background-color:#dbe9f9; padding:5px; border:solid thin #b1c2d6;"><p><span>Описание</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:200px; padding:5px; border:solid thin #b1c2d6;"><p><span>INIT_SUCCEEDED</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Инициализация прошла успешно, тестирование эксперта можно продолжать.</span></p> <p><span>Этот код означает то же самое, что и нулевое значение – инициализация эксперта в тестере прошла успешно.</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:200px; padding:5px; border:solid thin #b1c2d6;"><p><span>INIT_FAILED</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Неудачная инициализация, тестирование нет смысла продолжать из-за неустранимых ошибок. Например, не удалось создать индикатор, необходимый для работы эксперта.</span></p> <p><span>Возврат этого значения означает то же самое, что и возврат значения, отличного от нуля – инициализация эксперта в тестере прошла неудачно.</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:200px; padding:5px; border:solid thin #b1c2d6;"><p><span>INIT_PARAMETERS_INCORRECT</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Предназначен для обозначения программистом некорректного набора входных параметров, в общей таблице оптимизации строка результата с таким кодом возврата будет подсвечена красным цветом.</span></p> <p><span>Тестирование для данного набора параметров эксперта не будет выполняться.</span></p> </td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Функция OnInit() типа void всегда означает удачную инициализацию.</span></p> 
<h3><a id="ondeinit"></a>OnDeinit</h3> 
<p><span>Функция OnDeinit() вызывается при деинициализации и является обработчиком события <a href="/runtime/event_fire#deinit">Deinit</a>. Должна быть объявлена с типом </span><span style="color: #0000ff;">void</span><span> и иметь один параметр типа </span><span style="color: #0000ff;">const int</span><span> , который содержит <a href="/constants/namedconstants/uninit">код причины деинициализации</a>. Е</span><span>сли объявлен иной тип, компилятор выдаст предупреждение, но функция вызываться не будет.</span></p>
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnDeinit</span><span>(</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;reason);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Событие Deinit генерируется для экспертов и индикаторов в следующих случаях:</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>перед переинициализацией в связи со сменой символа или периода графика, к которому прикреплена mql4-программа;</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 8px 17px 7px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>перед переинициализацией в связи со сменой <a href="/basis/variables/inputvariables">входных параметров</a>;</span></p>
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>перед выгрузкой mql4-программы.</span></p> 
<h3><a id="ontick"></a>OnTick</h3> 
<p><span>Событие <a href="/runtime/event_fire#newtick">NewTick</a> генерируется </span><span style="font-weight: bold;">только для экспертов</span><span> при поступлении нового тика по символу, к графику которого прикреплен эксперт. Функцию OnTick() бесполезно определять в пользовательском индикаторе или скрипте, поскольку событие NewTick для них не генерируется. </span></p>
<p><span>Событие Tick генерируется только для экспертов, но это не означает, что эксперты обязаны иметь функцию OnTick(), так как для экспертов генерируются не только события NewTick, но и события Timer, BookEvent и ChartEvent. Должна быть объявлена с типом </span><span style="color: #0000ff;">void</span><span>, параметров не имеет:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnTick</span><span>();</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<h3><a id="ontimer"></a>OnTimer</h3> 
<p><span>Функция OnTimer() вызывается при наступлении события <a href="/runtime/event_fire#timer">Timer</a>, которое генерируется системным таймером только для экспертов и индикаторов – использовать ее в скриптах нельзя. Периодичность наступления этого события устанавливается при подписке на получение функцией <a href="/eventfunctions/eventsettimer">EventSetTimer()</a> уведомлений о событии Timer. </span></p>
<p><span>Отписывание от приема посылки событий таймера для конкретного эксперта производится функцией <a href="/eventfunctions/eventkilltimer">EventKillTimer()</a>. Функция должна быть определена с типом void, параметров не имеет:</span></p>
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnTimer</span><span>();</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Рекомендуется вызывать функцию EventSetTimer() однократно в функции OnInit(), а функцию EventKillTimer() вызывать однократно в OnDeinit().</span></p> 
<p><span>Каждый эксперт и каждый индикатор работает со своим таймером, и получает события только от него. При завершении работы mql4-программы таймер уничтожается принудительно, если он был создан, но не был отключен функцией <a href="/eventfunctions/eventkilltimer">EventKillTimer()</a>.</span></p>
<h3><a id="ontester"></a>OnTester</h3> 
<p><span>Функция OnTester() является обработчиком события <a href="/runtime/event_fire#tester">Tester</a>, которое автоматически генерируется по окончании исторического тестирования эксперта на заданном интервале дат. Функция должна быть определена с типом double, параметров не имеет:</span></p>
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">double</span><span>&nbsp;</span><span style="color: #0000ff;">OnTester</span><span>();</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Функция вызывается непосредственно перед вызовом функции OnDeinit() и имеет тип возвращаемого значения double. Функция OnTester() может быть использована только в экспертах при тестировании и предназначена в первую очередь для расчета некоторого значения, используемого в качестве критерия Custom max при генетической оптимизации входных параметров.</span></p> 
<p><span>При генетической оптимизации сортировка результатов в пределах одного поколения производится по убыванию. То есть, лучшими с точки зрения критерия оптимизации считаются результаты с наибольшим значением (для критерия оптимизации Custom max в расчет принимаются значения, возвращенные функцией OnTester). Худшие значения при такой сортировке помещаются в конец и впоследствии отбрасываются и не принимают участия в формировании следующего поколения.</span></p> 
<h3><a id="onchartevent"></a>OnChartEvent</h3> 
<p><span>OnChartEvent() является обработчиком группы событий <a href="/runtime/event_fire#chartevent">ChartEvent</a>:</span></p>
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_KEYDOWN — событие нажатия клавиатуры, когда окно графика находится в фокусе;</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 26px; margin: 0px 0px 0px 4px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_MOUSE_MOVE — события перемещения мыши и нажатия кнопок мыши (если для графика установлено свойство <a href="/constants/chartconstants/enum_chart_property#enum_chart_property_integer">CHART_EVENT_MOUSE_MOVE</a>=true);</span></p>
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_OBJECT_CREATE — событие создания графического объекта (если для графика установлено свойство <a href="/constants/chartconstants/enum_chart_property#enum_chart_property_integer">CHART_EVENT_OBJECT_CREATE</a>=true);</span></p>
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_OBJECT_CHANGE — событие изменения свойств объекта через диалог свойств;</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_OBJECT_DELETE — событие удаления графического объекта (если для графика установлено свойство <a href="/constants/chartconstants/enum_chart_property#enum_chart_property_integer">CHART_EVENT_OBJECT_DELETE</a>=true);</span></p>
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_CLICK — cобытие щелчка мыши на графике;</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_OBJECT_CLICK — событие щелчка мыши на графическом объекте, принадлежащем графику;</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_OBJECT_DRAG — событие перемещения графического объекта при помощи мыши;</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_OBJECT_ENDEDIT — событие окончания редактирования текста в поле ввода графического объекта LabelEdit;</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_CHART_CHANGE — событие изменения графика;</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_CUSTOM+n — идентификатор пользовательского события, где n находится в диапазоне от 0 до 65535.</span></p> 
<p style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 13px; margin: 2px 17px 3px 17px;"><span style="display:inline-block;width:13px;margin-left:-13px;font-size:10pt;font-family:'Symbol';font-style:normal;color:#565656;text-decoration:none;">•</span><span>CHARTEVENT_CUSTOM_LAST — последний допустимый идентификатор пользовательского события (CHARTEVENT_CUSTOM+65535).</span></p> 
<p><span>Функция может вызываться в экспертах и индикаторах, должна иметь тип void и 4 параметра: </span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnChartEvent</span><span>(</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;id,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;идентификатор&nbsp;события&nbsp;&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">long</span><span>&amp;&nbsp;lparam,&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;параметр&nbsp;события&nbsp;типа&nbsp;long</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double</span><span>&amp;&nbsp;dparam,&nbsp;</span><span style="color: #808080;">//&nbsp;параметр&nbsp;события&nbsp;типа&nbsp;double</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">string</span><span>&amp;&nbsp;sparam&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;параметр&nbsp;события&nbsp;типа&nbsp;string</span><br> <span>&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Для каждого типа события входные параметры функции OnChartEvent() имеют определенные значения, которые необходимы для обработки этого события. В таблице перечислены события и значения, которые передаются через параметры.</span></p> 
<div style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 8px 17px 7px 17px;"> 
 <table cellpadding="5" border="1" style="border:solid 2px #b1c2d6; border-spacing:0px; border-collapse:collapse;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; background-color:#dbe9f9; padding:5px; border:solid thin #b1c2d6;"><p><span style="font-weight: bold;">Событие</span></p> </td> 
    <td style="vertical-align:top; background-color:#dbe9f9; padding:5px; border:solid thin #b1c2d6;"><p><span style="font-weight: bold;">Значение параметра id</span></p> </td> 
    <td style="vertical-align:top; background-color:#dbe9f9; padding:5px; border:solid thin #b1c2d6;"><p><span style="font-weight: bold;">Значение параметра lparam</span></p> </td> 
    <td style="vertical-align:top; background-color:#dbe9f9; padding:5px; border:solid thin #b1c2d6;"><p><span style="font-weight: bold;">Значение параметра dparam</span></p> </td> 
    <td style="vertical-align:top; background-color:#dbe9f9; padding:5px; border:solid thin #b1c2d6;"><p><span style="font-weight: bold;">Значение параметра sparam</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Событие нажатия клавиатуры</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>CHARTEVENT_KEYDOWN</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Код нажатой клавиши</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Количество нажатий клавиши,сгенерированных за время её удержания в нажатом состоянии</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Строковое значение битовой маски, описывающее статус кнопок клавиатуры</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>События мыши </span><span>(если для графика установлено свойство <a href="/constants/chartconstants/enum_chart_property#enum_chart_property_integer">CHART_EVENT_MOUSE_MOVE</a>=true)</span></p> </td>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>CHARTEVENT_MOUSE_MOVE</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>X координата</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Y координата</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Строковое значение битовой маски, описывающее статус кнопок мыши</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Событие создания графического объекта (если для графика установлено свойство <a href="/constants/chartconstants/enum_chart_property#enum_chart_property_integer">CHART_EVENT_OBJECT_CREATE</a>=true)</span></p> </td>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>CHARTEVENT_OBJECT_CREATE</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Имя созданного графического объекта</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Событие изменения свойств объекта через диалог свойств</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>CHARTEVENT_OBJECT_CHANGE</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Имя измененного графического объекта</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Событие удаления графического объекта (если для графика установлено свойство <a href="/constants/chartconstants/enum_chart_property#enum_chart_property_integer">CHART_EVENT_OBJECT_DELETE</a>=true)</span></p> </td>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>CHARTEVENT_OBJECT_DELETE </span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Имя удаленного графического объекта</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Событие щелчка мыши на графике</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span> CHARTEVENT_CLICK</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>X координата</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Y координата</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Событие щелчка мыши на графическом объекте</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>CHARTEVENT_OBJECT_CLICK</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>X координата</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Y координата</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Имя графического объекта, на котором произошло событие</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Событие перемещения графического объекта при помощи мыши</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>CHARTEVENT_OBJECT_DRAG</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Имя перемещенного графического объекта</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Событие окончания редактирования текста в поле ввода графического объекта "Поле ввода"</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>CHARTEVENT_OBJECT_ENDEDIT</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Имя графического объекта "Поле ввода", в котором завершилось редактирование текста</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Событие изменения графика</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>CHARTEVENT_CHART_CHANGE</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>—</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Пользовательское событие с номером N</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>CHARTEVENT_CUSTOM+N</span></p> </td> 
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Значение, заданное функцией <a href="/eventfunctions/eventchartcustom">EventChartCustom()</a></span></p> </td>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Значение, заданное функцией <a href="/eventfunctions/eventchartcustom">EventChartCustom()</a></span></p> </td>
    <td style="vertical-align:top; padding:5px; border:solid thin #b1c2d6;"><p><span>Значение, заданное функцией <a href="/eventfunctions/eventchartcustom">EventChartCustom()</a></span></p> </td>
   </tr> 
  </tbody> 
 </table> 
</div> 
<h3><a id="oncalculate"></a>OnCalculate</h3> 
<p><span>Функция OnCalculate() вызывается только в пользовательских индикаторах при необходимости произвести расчет значений индикатора по событию <a href="/runtime/event_fire#calculate">Calculate</a>. Обычно это происходит при поступлении нового тика по символу, для которого рассчитывается индикатор. При этом индикатор не обязательно должен быть прикреплен к какому-нибудь ценовому графику данного символа. </span></p>
<p><span>Функция OnCalculate() должна иметь тип возвращаемого значения int.</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">int</span><span>&nbsp;</span><span style="color: #0000ff;">OnCalculate</span><span>&nbsp;(</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;rates_total,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;размер&nbsp;входных&nbsp;таймсерий</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;prev_calculated,&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;обработано&nbsp;баров&nbsp;на&nbsp;предыдущем&nbsp;вызове</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">datetime&nbsp;</span><span>&amp;time[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Time</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double&nbsp;</span><span>&amp;open[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Open</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double&nbsp;</span><span>&amp;high[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;High</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double&nbsp;</span><span>&amp;low[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Low</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double&nbsp;</span><span>&amp;close[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Close</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">long&nbsp;</span><span>&amp;tick_volume[],&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Tick&nbsp;Volume</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">long&nbsp;</span><span>&amp;volume[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Real&nbsp;Volume</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int&nbsp;</span><span>&amp;spread[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Spread</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Параметры open[], high[], low[] и close[] содержит массивы с ценами открытия, максимальной, минимальной ценами и ценами закрытия текущего таймфрейма. Параметр time[] содержит массив со значениями времени открытия, параметр spread[] – массив, содержащий историю спредов (если спред предусмотрен для данного торгового инструмента). Параметры volume[] и tick_volume[] содержат соответственно историю торгового и тикового объема.</span></p> 
<p><span>Чтобы определить направление индексации в массивах time[], open[], high[], low[], close[], tick_volume[], volume[] и spread[], необходимо вызывать функцию <a href="/array/arraygetasseries">ArrayGetAsSeries()</a>. Чтобы не зависеть от умолчаний, необходимо безусловно вызывать функцию <a href="/array/arraysetasseries">ArraySetAsSeries()</a> для тех массивов, с которыми предполагается работать.</span></p>
<p><span>Первый параметр rates_total содержит количество баров, доступных индикатору для расчета, и соответствует количеству баров, доступных на графике.</span></p> 
<p><span>Необходимо отметить связь между значением, возвращаемым функцией OnCalculate() и вторым входным параметром prev_calculated. Параметр prev_calculated при вызове функции содержит значение, которое </span><span style="font-weight: bold;">вернула</span><span> функция OnCalculate() на </span><span style="font-weight: bold;">предыдущем</span><span> вызове. Это позволяет реализовать экономные алгоритмы расчета пользовательского индикатора с тем, чтобы избежать повторных расчетов для тех баров, которые не изменились с предыдущего запуска этой функции. </span></p> 
<p><span>Для этого обычно достаточно вернуть значение параметра rates_total, которое содержит количество баров при текущем вызове функции. Если с момента последнего вызова функции OnCalculate() ценовые данные были изменены (подкачана более глубокая история или были заполнены пропуски истории), то значение входного параметра prev_calculated будет установлено в нулевое значение самим терминалом. </span></p> 
<p><span>Для лучшего понимания будет полезно запустить индикатор, код которого приложен ниже.</span></p> 
<p><span style="font-weight: bold;">Пример индикатора:</span></p> 
<div style="text-align: left; text-indent: 0px; page-break-inside: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;"> 
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody> 
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">indicator_chart_window</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">indicator_buffers</span><span>&nbsp;1</span><br> <span style="color: #808080;">//----&nbsp;plot&nbsp;Line</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">indicator_label1</span><span>&nbsp;&nbsp;</span><span style="color: #008080;">"Line"</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">indicator_type1</span><span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">DRAW_LINE</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">indicator_color1</span><span>&nbsp;&nbsp;</span><span style="color: #0000ff;">clrDarkBlue</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_style1&nbsp;&nbsp;</span><span style="color: #0000ff;">STYLE_SOLID</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">indicator_width1</span><span>&nbsp;&nbsp;1</span><br> <span style="color: #808080;">//---&nbsp;indicator&nbsp;buffers</span><br> <span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LineBuffer[];</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Custom&nbsp;indicator&nbsp;initialization&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">int</span><span>&nbsp;</span><span style="color: #0000ff;">OnInit</span><span>()</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---&nbsp;indicator&nbsp;buffers&nbsp;mapping</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">SetIndexBuffer</span><span>(0,LineBuffer,</span><span style="color: #0000ff;">INDICATOR_DATA</span><span>);</span><br> <span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">INIT_SUCCEEDED</span><span>);</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Custom&nbsp;indicator&nbsp;iteration&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">int</span><span>&nbsp;</span><span style="color: #0000ff;">OnCalculate</span><span>(</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;rates_total,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;prev_calculated,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&amp;&nbsp;time[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double</span><span>&amp;&nbsp;open[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double</span><span>&amp;&nbsp;high[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double</span><span>&amp;&nbsp;low[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double</span><span>&amp;&nbsp;close[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">long</span><span>&amp;&nbsp;tick_volume[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">long</span><span>&amp;&nbsp;volume[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&amp;&nbsp;spread[])</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---&nbsp;получим&nbsp;количество&nbsp;доступных&nbsp;баров&nbsp;для&nbsp;текущих&nbsp;символа&nbsp;и&nbsp;периода&nbsp;на&nbsp;графике</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;</span><span style="color: #0000ff;">bars</span><span>=</span><span style="color: #0000ff;">Bars</span><span>(</span><span style="color: #0000ff;">Symbol</span><span>(),0);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Bars&nbsp;=&nbsp;"</span><span>,</span><span style="color: #0000ff;">bars</span><span>,</span><span style="color: #008080;">",&nbsp;rates_total&nbsp;=&nbsp;"</span><span>,rates_total,</span><span style="color: #008080;">",&nbsp;prev_calculated&nbsp;=&nbsp;"</span><span>,prev_calculated);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"time[0]&nbsp;=&nbsp;"</span><span>,time[0],</span><span style="color: #008080;">"&nbsp;time[rates_total-1]&nbsp;=&nbsp;"</span><span>,time[rates_total-1]);</span><br> <span style="color: #808080;">//---&nbsp;return&nbsp;value&nbsp;of&nbsp;prev_calculated&nbsp;for&nbsp;next&nbsp;call</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(rates_total);</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span></p></td> 
   </tr> 
  </tbody> 
 </table> 
</div> 
<p><span>Смотри также</span></p> 
<p><span><a href="/runtime/running">Выполнение программ</a>, <a href="/runtime/event_fire">События клиентского терминала</a>, <a href="/eventfunctions">Работа с событиями</a></span></p>
<br>