<h1>What's New in MQL4</h1> 
<p><span>Starting from build 600, MQL4 programming language has been completely revised reaching the level of MQL5 - now you can develop trading robots in MQL4/5 using the unified MetaEditor development environment, single style, libraries and debugging tools.</span></p> 
<p><span>MQL4 is popular among automated system developers due to the ease of learning and a huge amount of code generated for many years of using MetaTrader 4 terminal. However, the language also has some drawbacks arising from its main advantage - a simple programming language does not allow development of complex systems and hinders porting of debugged libraries from high-level languages. Therefore, we decided to implement in it the maximum possible amount of MQL5 language functions and features fully preserving MQL4 functionality. In other words, all powerful MQL5 functions, including ООP and the native code compiler, will become available in MQL4.</span></p> 
<p><span>To achieve this, we have developed a unified compiler that automatically supports both MQL4 and MQL5 languages. MetaEditor will also become a unified application both for MetaTrader 4 and MetaTrader 5 platforms. Thus, it will be possible to compile both MQL4 and MQL5 from any version. MQL5 Storage also becomes available for work.</span></p> 
<p><span>Protection of MQL4 applications rises to MQL5 level. New EX4/EX5 files are provided with a serious and completely revised protection. This means that the Market of secure EX4 applications also becomes available to MetaTrader 4.</span></p> 
<p><span>Besides, MQL4 now features new graphical objects and new functions for working with charts. MQL5 Standard Library is to be ported to MQL4 providing developers with new possibilities in creating their own graphical interfaces and trading libraries. Now, you can create full-fledged applications in MetaTrader 4 using the resources.</span><br> <span>&nbsp;</span></p> 
<h1>Changes in MQL4 Language</h1> 
<p><span>Added new <a href="/basis/types/integer/integertypes#char">char</a>, <a href="/basis/types/integer/integertypes#short">short</a>, <a href="/basis/types/integer/integertypes#long">long</a>, <a href="/basis/types/integer/integertypes#uchar">uchar</a>, <a href="/basis/types/integer/integertypes#ushort">ushort</a>, <a href="/basis/types/integer/integertypes#uint">uint</a>, <a href="/basis/types/integer/integertypes#ulong">ulong</a> and <a href="/basis/types/double">double</a> data types. This will allow transferring codes from other C++ like languages. Data of various types is processed at different rates. Integer data is the fastest one to be processed. A special co-processor is used to handle the double-precision data. However, due to the complexity of the internal representation of floating-point data, it is processed slower than integer one. <a href="/basis/types/casting">Typecasting</a> has also been implemented.</span></p> 
<p><span>Strings are now presented in Unicode format, though they were in ANSI format (single byte ones) before. That should be considered if the program uses DLLs and passes string variables to them.</span></p> 
<p><span>Predefined <a href="/predefined/volume">Volume</a> variable is now of long type. The time series for accessing the volumes also consist of long type arrays. It is recommended to use explicit casting of data having this type to the target type in old MQL4 programs to avoid type overflow error.</span></p> 
<p><span>Structures and classes, object pointers, <a href="/basis/types/void">void</a> type and <a href="/basis/types/this">this</a> key word allowing an object to receive a reference to itself have been added. All object-oriented programming standards are supported:</span></p> 
<ul style="text-indent:0px; padding-left:0; margin-top:0; margin-bottom:0; margin-left: 30px;list-style-position:outside; list-style-type:disc"> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 8px; margin-right: 17px; margin-bottom: 7px;"><span><a href="/basis/oop/incapsulation">Encapsulation and Extensibility of Types</a></span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 8px; margin-right: 17px; margin-bottom: 7px;"><span><a href="/basis/oop/inheritance">Inheritance</a></span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 8px; margin-right: 17px; margin-bottom: 7px;"><span><a href="/basis/oop/polymorphism">Polymorphism</a></span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 8px; margin-right: 17px; margin-bottom: 7px;"><span><a href="/basis/oop/overload">Overload</a></span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 8px; margin-right: 17px; margin-bottom: 7px;"><span><a href="/basis/oop/virtual">Virtual functions</a></span></li> 
</ul> 
<p><span>ООP allows developing programs using classes. This facilitates debugging and development of large applications, as well as provides ability to reuse previously generated code multiple times due to inheritance. However, that does not mean that you cannot generate your MQL4 code in procedure-oriented style as before. You can develop your programs as you did in the past if you don't need the new features.</span></p> 
<p><span>init(), deinit() and start() predefined functions have remained for compatibility, however, <a href="/basis/function/events#oninit">OnInit()</a>, <a href="/basis/function/events#ondeinit">OnDeinit()</a>, <a href="/basis/function/events#onstart">OnStart()</a>, <a href="/basis/function/events#oncalculate">OnCalculate()</a> and <a href="/basis/function/events#ontick">OnTick()</a> ones can now be used instead. Besides, new predefined <a href="/basis/function/events#ontimer">OnTimer()</a>, <a href="/basis/function/events#onchartevent">OnChartEvent()</a> and <a href="/basis/function/events#ontester">OnTester()</a> handler functions have been implemented. In the previous MQL4, predefined functions could have any parameters and any return type, and they could be called by their names, not signatures. In the new MQL4, all predefined functions should strictly correspond to their signatures. In other words, they should have precisely defined set of parameters and return type.</span></p> 
<p><span>Now, variable names cannot contain special characters and points, and new MQL4 language keywords cannot be used as names. Old MQL4 programs can be recompiled with the new compiler in order to easily correct all such errors while following the compiler's messages.</span></p> 
<p><span>The <a href="/basis/operations/rules">Precedence rule</a> now matches C language standards. If you are unsure, you can insert parentheses in old MQL4 apps to clearly indicate the priority to increase reliability. </span></p> 
<p><span>Shortened conditions check is now used in <a href="/basis/operations/bool">logical operations</a>, unlike the old MQL4 version where all expressions have been calculated and the check has been performed afterwards. Suppose there is a check of two conditions with the use of logical AND:</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(condition1&nbsp;&amp;&amp;&nbsp;condition2)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;some&nbsp;block&nbsp;of&nbsp;statements</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>If condition1 expression is false, calculation of condition2 expression is not performed, as false &amp;&amp; true result is still equal to false.</span></p> 
<p><span>&nbsp;</span></p> 
<p><span><a href="/array/arraycopyrates">ArrayCopyRates()</a> function behavior has changed. In the previous MQL4 versions this function was used for copying price series to array double[][6]. Now, if you need to receive a time series, use the arrays of the <a href="/constants/structures/mqlrates">MqlRates</a> structure elements:</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #808080;">//---&nbsp;Structure&nbsp;that&nbsp;stores&nbsp;information&nbsp;about&nbsp;the&nbsp;prices,&nbsp;volumes&nbsp;and&nbsp;spread.</span><br> <span style="color: #0000ff;">struct&nbsp;</span><span style="font-weight: bold;">MqlRates</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&nbsp;</span><span>time</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Period&nbsp;start&nbsp;time</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;</span><span>open</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Open&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;</span><span>high</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;The&nbsp;highest&nbsp;price&nbsp;of&nbsp;the&nbsp;period</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;</span><span>low</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;The&nbsp;lowest&nbsp;price&nbsp;of&nbsp;the&nbsp;period</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;</span><span>close</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Close&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">long</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>tick_volume</span><span>;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Tick&nbsp;volume</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>spread</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Spread</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">long</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>real_volume</span><span>;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;Trade&nbsp;volume</span><br> <span>&nbsp;&nbsp;};</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>Also the new function format can be used for virtual copying, when there is no actual copying, and accessing the copied values you actually access the price data.</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>int&nbsp;&nbsp;</span><span>ArrayCopyRates</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>MqlRates&amp;</span><span>&nbsp;&nbsp;</span><span>rates_array[]</span><span>,&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;MqlRates&nbsp;array,&nbsp;passed&nbsp;by&nbsp;reference</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>string&nbsp;&nbsp;&nbsp;&nbsp;</span><span>&nbsp;</span><span>symbol=NULL</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;symbol</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>timeframe=0&nbsp;&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;timeframe</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>To provide compatibility with old MQL4 programs, the previous call format is also preserved, but now it leads to actual copying of data into a double-type array. </span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>int&nbsp;&nbsp;</span><span>ArrayCopyRates</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>void&amp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>dest_array[][]</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;destination&nbsp;array,&nbsp;passed&nbsp;by&nbsp;reference</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>string&nbsp;&nbsp;&nbsp;</span><span>&nbsp;</span><span>symbol=NULL</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;symbol</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>timeframe=0&nbsp;&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;timeframe</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>This means that when the values in the time series change (new bars are added, restructuring, the last bar's Close price is uodated), you must re-copy the required data into the dest_array[][]. The receiver array will be automatically allocated for the required number of copied bars, even if it was declared statically.</span></p> 
<p><span>&nbsp;</span></p> 
<p><span>Changed RateInfo history data storage format. RateInfo structure was presented as follows in the old version: </span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>struct</span><span>&nbsp;</span><span style="font-weight: bold;">RateInfo</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>unsigned</span><span>&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ctm</span><span>;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;bar&nbsp;open&nbsp;date</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>open</span><span>;&nbsp;&nbsp;</span><span>//&nbsp;Open&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>low</span><span>;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Low&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>high</span><span>;&nbsp;</span><span>&nbsp;//&nbsp;High&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>close</span><span>;&nbsp;</span><span>//&nbsp;Close&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>vol</span><span>;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;volume</span><br> <span>&nbsp;&nbsp;};</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>In the new format, RateInfo structure features fields for storing spread and trading volume:</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>//---&nbsp;Standard&nbsp;quote&nbsp;presentation&nbsp;in&nbsp;the&nbsp;new&nbsp;terminal&nbsp;version</span><br> <span>struct</span><span>&nbsp;</span><span style="font-weight: bold;">RateInfo</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>INT64</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ctm</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;open&nbsp;date&nbsp;and&nbsp;time</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>open</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Open&nbsp;price&nbsp;(absolute&nbsp;value)</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>high</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Low&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>low</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;High&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>close</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Close&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>UINT64</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>vol</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;tick&nbsp;volume</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>INT32</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>spread</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;spread</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>UINT64</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>real</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;trade&nbsp;volume</span><br> <span>&nbsp;&nbsp;};</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>Thus, if MQL4 programs contain DLLs for passing/accepting price data, the corresponding functions in the source codes should be rewritten and recompiled considering format changes to ensure proper operation.</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="font-weight: bold;">Old EX4 applications and DLLs based on old RateInfo format will not work in the new terminal. Conversion to the new format is required.</span></p> </td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>&nbsp;</span></p> 
<p><span>In <a href="/files">file operations</a>, the number of simultaneously opened files can now reach 64 ones, while there could be no more than 32 ones in the old MQL4. Until recently, the files were always opened in FILE_SHARE_READ or FILE_SHARE_WRITE mode. Now, the necessary opening mode should be specified explicitly.</span></p> 
<p><span>For <a href="/files/filewrite">FileWrite()</a>, <a href="/files/filewritearray">FileWriteArray()</a>, <a href="/files/filewritedouble">FileWriteDouble()</a>, <a href="/files/filewriteinteger">FileWriteInteger()</a> and <a href="/files/filewritestring">FileWriteString()</a> functions the type of returned value has been changed from <a href="/basis/types/integer/integertypes#int">int</a> to <a href="/basis/types/integer/integertypes#uint">uint</a>. The functions return the number of bytes, actually written or 0 in case of error (in old version of MQL4 the negative number is returned in case of error).</span></p> 
<p><span>Working with functions, scope of variables and memory release in local arrays has also been changed. Since the number of changes is large enough, the new <a href="/basis/preprosessor">#property strict</a> property has been introduced to provide maximum compatibility with the previous approach to developing MQL4 programs. When creating new MQL4 application using MQL wizard, this property is always added to the template. </span></p> 
<p><span>The string representation of </span><span style="color: #0000ff;"><a href="/basis/types/integer/datetime">datetime</a></span><span> type depends on compilation mode: </span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>&nbsp;&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&nbsp;date=D'2014.03.05&nbsp;15:46:58';</span><br> <span>&nbsp;&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;str=</span><span style="color: #008080;">"mydate="</span><span>+date;</span><br> <span style="color: #808080;">//---&nbsp;str="mydate=1394034418"&nbsp;-&nbsp;old&nbsp;compiler/new&nbsp;compiler&nbsp;without&nbsp;#property&nbsp;strict</span><br> <span style="color: #808080;">//---&nbsp;str="mydate=2014.03.05&nbsp;15:46:58"&nbsp;-&nbsp;new&nbsp;compiler&nbsp;with&nbsp;#property&nbsp;strict</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>The table below contains the differences between MQL4, new MQL4 without using strict and new MQL4 with specified strict compilation mode:</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">#property</span><span> </span><span style="color: #0000ff;">strict</span></p> </td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>When compiling libraries in the strict mode, the <a href="/basis/function/export">export</a> modifier should be added for each exported function, otherwise the function will not be accessible from outside.</span></p> 
<p><a id="compiler_difference"></a><span>The table of differences between compilers:</span></p> 
<div style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 8px 17px 7px 17px;">
 <table cellpadding="5" border="1" style="border:solid 2px #b1c2d6; border-spacing:0px; border-collapse:collapse;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; width:339px; background-color:#dbe9f9; padding:5px; border:solid thin #b1c2d6;"><p><span style="font-weight: bold;">Old MQL4 compiler</span></p> </td> 
    <td style="vertical-align:top; width:345px; background-color:#dbe9f9; padding:5px; border:solid thin #b1c2d6;"><p><span style="font-weight: bold;">New MQL4 compiler</span></p> </td> 
    <td style="vertical-align:top; width:400px; background-color:#dbe9f9; padding:5px; border:solid thin #b1c2d6;"><p><span style="font-weight: bold;">New MQL4 with #property strict</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>init(), start() and deinit() entry points may have any parameters and any return type </span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>init(), start() and deinit() have been remained intact for compatibility,</span></p> <p><span>while new <a href="/basis/function/events#oninit">OnInit()</a>, <a href="/basis/function/events#onstart">OnStart()</a>, <a href="/basis/function/events#oncalculate">OnCalculate()</a>, <a href="/basis/function/events#ontick">OnTick()</a>, <a href="/basis/function/events#ontimer">OnTimer()</a>, <a href="/basis/function/events#onchartevent">OnChartEvent()</a>, <a href="/basis/function/events#ontester">OnTester()</a> and <a href="/basis/function/events#ondeinit">OnDeinit()</a> should strictly correspond to their signatures</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>Ditto</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>The result of the return from init() function is not analyzed by the runtime subsystem</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>The result of the return from init() and OnInit() functions is not analyzed by the runtime subsystem</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>If a non-zero value is returned from OnInit(), the operation of an Expert Advisor or an indicator is stopped, the program is unloaded</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>Virtually any variable names (except for the reserved words) are possible, including special characters and points</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>Variable names cannot have special characters and points.</span></p> <p><span>The list of the <a href="/basis/syntax/reserved">reserved words</a> has been expanded. Thus, such widespread words as short, long, const, etc. cannot be used as names</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>Ditto</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>Variable scope is from declaration (even in the nested block) to the function end</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>Ditto</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>Variable scope is from declaration to the end of the block, in which the variable is declared</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>Implicit initialization of all the variables (both global and local ones) by zero</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>Ditto</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>Only global variables are initialized. In local variables, only strings are initialized implicitly</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>Local arrays are not released when exiting the function</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>Local arrays are released when exiting the function</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>Local arrays are released when exiting {} block</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span style="font-weight: bold;">"Array out of range"</span><span> does not cause a critical error</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>Ditto, except for the arrays of structures and classes, for which this error is critical one</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span style="font-weight: bold;">"Array out of range"</span><span> is a critical error causing the program to stop</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>No structures and classes</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span><a href="/basis/types/classes">Structures and classes</a> are present. Additional data types are implemented</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>Ditto</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>Strings are single-byte.</span></p> <p><span>datetime is a 32-bit integer</span></p> <p><span>Predefined Volume variable is of double type</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>Strings are unicode ones.</span></p> <p><span>datetime is a 64-bit integer</span></p> <p><span>Predefined <a href="/predefined/volume">Volume</a> variable is of long type</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>Ditto</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span><a href="/array/arraycopyrates">ArrayCopyRates()</a> performs virtual copying to double[][6] array </span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span><a href="/array/arraycopyrates">ArrayCopyRates()</a> performs virtual copying to MqlRates[] array. Copying to double[][6] array has remained intact for the sake of compatibility, however, that copying is real, not virtual.</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>Ditto</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>The functions may not return values even if they have a type. To do this, return(0) is automatically inserted by the compiler in the function end</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>Ditto</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>Functions of any type should return a value</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>The number of simultaneously opened files is 32</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>The number of simultaneously opened files is 64</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>Ditto</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>The files are always opened in FILE_SHARE_READ, FILE_SHARE_WRITE mode **</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>FILE_SHARE_READ and/or FILE_SHARE_WRITE should be specified explicitly</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>Ditto</span></p> </td> 
   </tr> 
   <tr>
    <td style="vertical-align:top; width:339px; padding:5px; border:solid thin #b1c2d6;"><p><span>The names of <a href="/basis/variables/externvariables">extern</a> variables are displayed for scripts in the input parameters window</span></p> </td> 
    <td style="vertical-align:top; width:345px; padding:5px; border:solid thin #b1c2d6;"><p><span>The names of <a href="/basis/variables/externvariables">extern</a> and <a href="/basis/variables/inputvariables">input</a> variables are displayed for scripts in show_inputs mode in the input parameters window</span></p> </td> 
    <td style="vertical-align:top; width:400px; padding:5px; border:solid thin #b1c2d6;"><p><span>String comments instead of <a href="/basis/variables/externvariables">extern</a> and <a href="/basis/variables/inputvariables">input</a> variable names are displayed for scripts in show_inputs mode in the input parameters window </span></p> </td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>* Please pay special attention to "Array out of range" error - many old custom indicators will display this error in strict mode of the new compiler when launched on the chart. It is recommended to find the cause and eliminate it.</span></p> 
<p><span>** &nbsp;In the new MQL4 and MQL5, FILE_SHARE_READ and FILE_SHARE_WRITE flags are responsible for the files shared use mode. There were no such files in the old MQL4.</span></p> 
<h1>&nbsp;</h1> 
<h1>Changes in File Structure</h1> 
<p><span>In the previous builds of MetaTrader 4 client terminal (509 and older), all MQL4 applications were stored in the following subdirectories of </span><span style="font-weight: bold;">&lt;terminal_installation_folder&gt;\experts\</span><span> root directory:</span></p> 
<ul style="text-indent:0px; padding-left:0; margin-top:0; margin-bottom:0; margin-left: 30px;list-style-position:outside; list-style-type:disc"> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\experts - Expert Advisors (trading robots),</span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\experts\indicators - custom indicators,</span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\experts\scripts - scripts (MQL4 applications for a single run on the chart),</span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\include - source code MQH and MQ4 files implemented into other programs,</span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\libraries - libraries in the form of MQ4 source codes and EX4 executable files compiled from them. They are used for the dynamic call of the functions contained there by other MQL4 programs,</span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\files - special "file sandbox". MQL4 applications are allowed to execute file operations only within this directory.</span></li> 
</ul> 
<p><span>&nbsp;</span><br> <span>In the new MQL4 version, the file structure for storing the source codes has changed. Now, all MQL4 applications should be located in the appropriate folders of </span><span style="font-weight: bold;">&lt;data_folder&gt;\MQL4\</span><span> directory:</span></p> 
<ul style="text-indent:0px; padding-left:0; margin-top:0; margin-bottom:0; margin-left: 30px;list-style-position:outside; list-style-type:disc"> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\Experts - Expert Advisors (trading robots),</span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\Indicators - custom indicators,</span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\Scripts - scripts (MQL4 applications for a single run on the chart),</span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\Include - source code MQH and MQ4 files implemented into other programs,</span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\Libraries - libraries in the form of MQ4 source codes and EX4 executable files compiled from them. They are used for the dynamic call of the functions contained there by other MQL4 programs,</span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\Images - image files for using in resources,</span></li> 
 <li style="text-align: justify; padding: 0px 0px 0px 0px; margin-top: 3px; margin-right: 17px; margin-bottom: 3px;"><span>\Files - special "file sandbox". MQL4 applications are allowed to execute file operations only within this directory.</span></li> 
</ul> 
<p><span>When updating MetaTrader 4 terminal from build 509 to the newer version, all MQ4, MQH and EX4 files from standard root directories of the previous version are automatically copied and relocated to the appropriate folders. </span><span style="font-weight: bold;">Subfolders additionally created by a user, as well as files contained there are not processed.</span><span> They should be relocated to the new place manually if necessary.</span><br> <span>&nbsp;</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="font-weight: bold;">No files or folders are deleted during the update!</span><span> All file copy operations including used file paths are fixed in the terminal Journal during the update.</span></p> </td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>&nbsp;</span><br> <span style="font-weight: bold;">No automatic re-compilation of the old EX4 files to the new version is performed during the update.</span><span> Users are free to decide what source codes should be compiled to the new EX4 version. All old EX4 will work in the new MetaTrader 4 terminal. EX4 libraries compiled by the new compiler can be called only from the EX4 programs that have also been compiled in the new version.</span></p> 
<p><span>In some cases, you may need to edit the path in <a href="/basis/preprosessor/include">#include</a> for included files (if relative paths have changed) in the source files. Please note that MetaEditor's root directory is now &lt;data_folder&gt;\MQL4\. All programs should be located in the correct subdirectories.</span></p> 
<p><span>You can find the data folder (&lt;data_folder&gt;) for each copy of MetaTrader 4 terminal on your computer via the terminal menu or in MetaEditor: File - Open Data Folder.</span></p> 
<br>