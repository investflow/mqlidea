<h1>CopyRates</h1> 
<p><span>Gets history data of <a href="/constants/structures/mqlrates">MqlRates</a> structure of a specified symbol-period in specified quantity into the rates_array array. The elements ordering of the copied data is from present to the past, i.e., starting position of 0 means the current bar.</span></p> 
<p><img alt="CopyRates" width="656" height="214" style="margin:0;width:656px;height:214px;border:none" src="https://c.mql4.com/i/docs/en/copyrates.png"></p> 
<p><span>When copying the yet unknown amount of data, it</span><span> is recommended to use </span><span><a href="/basis/types/dynamic_array">dynamic array</a></span><span> as a target array, because if the requested data count is less (or more) than the length of the target array, function </span><span>tries to reallocate the memory so that the requested data fit entirely.</span></p> 
<p><span>If you know the amount of data you need to copy, it should better be done to a <a href="/basis/types/dynamic_array#static_array">statically allocated buffer</a>, in order to prevent the allocation of excessive memory.</span></p> 
<p><span>No matter what is the property of the target array - as_series=true or as_series=false. Data will be copied so that the oldest element will be located at the start of the physical memory allocated for the array. There are 3 variants of function calls.</span></p> 
<p><span>Call by the first position and the number of required elements </span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>int&nbsp;&nbsp;</span><span>CopyRates</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>symbol_name</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;symbol&nbsp;name</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>ENUM_TIMEFRAMES</span><span>&nbsp;&nbsp;</span><span>timeframe</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;period</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>start_pos</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;start&nbsp;position</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>count</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;data&nbsp;count&nbsp;to&nbsp;copy</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>MqlRates</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>rates_array[]</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;target&nbsp;array&nbsp;to&nbsp;copy</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>Call by the start date and the number of required elements</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>int&nbsp;&nbsp;</span><span>CopyRates</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>symbol_name</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;symbol&nbsp;name</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>ENUM_TIMEFRAMES</span><span>&nbsp;&nbsp;</span><span>timeframe</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;period</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>datetime</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>start_time</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;start&nbsp;date&nbsp;and&nbsp;time</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>count</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;data&nbsp;count&nbsp;to&nbsp;copy</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>MqlRates</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>rates_array[]</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;target&nbsp;array&nbsp;to&nbsp;copy</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>Call by the start and end dates of a required time interval</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>int&nbsp;&nbsp;</span><span>CopyRates</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>symbol_name</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;symbol&nbsp;name</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>ENUM_TIMEFRAMES</span><span>&nbsp;&nbsp;</span><span>timeframe</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;period</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>datetime</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>start_time</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;start&nbsp;date&nbsp;and&nbsp;time</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>datetime</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>stop_time</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;end&nbsp;date&nbsp;and&nbsp;time</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>MqlRates</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>rates_array[]</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;target&nbsp;array&nbsp;to&nbsp;copy</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>Parameters</span></p> 
<p><span>symbol_name</span></p> 
<p><span>[in] &nbsp;Symbol name.</span></p> 
<p><span>timeframe</span></p> 
<p><span>[in] &nbsp;Period.</span></p> 
<p><span>start_time</span></p> 
<p><span>[in] &nbsp;Bar time for the first element to copy.</span></p> 
<p><span>start_pos</span></p> 
<p><span>[in] &nbsp;The start position for the first element to copy.</span></p> 
<p><span>count</span></p> 
<p><span>[in] &nbsp;Data count to copy.</span></p> 
<p><span>stop_time</span></p> 
<p><span>[in] &nbsp;Bar time, corresponding to the last element to copy.</span></p> 
<p><span>rates_array[]</span></p> 
<p><span>[out] &nbsp;Array of <a href="/constants/structures/mqlrates">MqlRates</a> type.</span></p> 
<p><span>Return Value</span></p> 
<p><span>Returns the number of copied elements or -1 in case of &nbsp;an <a href="/constants/errorswarnings/errorcodes">error</a>.</span></p> 
<p><span>Note</span></p> 
<p><span>If the whole interval of requested data is out of the available data on the server, the function returns -1. If data outside <a href="/constants/environment_state/terminalstatus">TERMINAL_MAXBARS</a> (maximal number of bars on the chart) is requested, the function will also return -1.</span></p> 
<p><span>If requested timeseries are not yet built or they need to be downloaded from the server, the function will immediately return -1.</span></p> 
<p><span>When requesting data by the start date and the number of required elements, only data whose date is less than (earlier) or equal to the date specified will be returned. It means, the open time of any bar, for which value is returned (volume, spread, value on the indicator buffer, prices Open, High, Low, Close or open time Time) is always less or equal to the specified one.</span></p> 
<p><span>When requesting data in a specified range of dates, only data from this interval will be returned. The interval is set and counted up to seconds. It means, the open time of any bar, for which value is returned (volume, spread, value on the indicator buffer, prices Open, High, Low, Close or open time Time) is always within the requested interval. </span></p> 
<p><span>Thus, if the current day is Saturday, at the attempt to copy data on a week timeframe specifying </span><span style="font-style: italic;">start_time=Last_Tuesday</span><span> and </span><span style="font-style: italic;">stop_time=Last_Friday</span><span> the function will return 0, because the open time on a week timeframe is always Sunday, but one week bar does not fall into the specified interval.</span></p> 
<p><span>If you need to return value corresponding to the current uncompleted bar, you can use the first form of call specifying </span><span style="font-style: italic;">start_pos</span><span>=0 and </span><span style="font-style: italic;">count</span><span>=1.</span></p> 
<p><span style="font-weight: bold;">Example:</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #0000ff;">void</span><span>&nbsp;</span><span style="color: #0000ff;">OnStart</span><span>()</span><br> <span>&nbsp;&nbsp;{</span><br> <span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">MqlRates</span><span>&nbsp;rates[];</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArraySetAsSeries</span><span>(rates,</span><span style="color: #0000ff;">true</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;copied=</span><span style="color: #0000ff;">CopyRates</span><span>(</span><span style="color: #0000ff;">Symbol</span><span>(),0,0,100,rates);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(copied&gt;0)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Bars&nbsp;copied:&nbsp;"</span><span>+copied);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;format=</span><span style="color: #008080;">"open&nbsp;=&nbsp;%G,&nbsp;high&nbsp;=&nbsp;%G,&nbsp;low&nbsp;=&nbsp;%G,&nbsp;close&nbsp;=&nbsp;%G,&nbsp;volume&nbsp;=&nbsp;%d"</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;out;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;size=</span><span style="color: #0000ff;">fmin</span><span>(copied,10);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;i=0;i&lt;size;i++)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out=i+</span><span style="color: #008080;">":"</span><span>+</span><span style="color: #0000ff;">TimeToString</span><span>(rates[i].time);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out=out+</span><span style="color: #008080;">"&nbsp;"</span><span>+</span><span style="color: #0000ff;">StringFormat</span><span>(format,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rates[i].open,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rates[i].high,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rates[i].low,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rates[i].close,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rates[i].tick_volume);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">Print</span><span>(out);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">else</span><span>&nbsp;</span><span style="color: #0000ff;">Print</span><span>(</span><span style="color: #008080;">"Failed&nbsp;to&nbsp;get&nbsp;history&nbsp;data&nbsp;for&nbsp;the&nbsp;symbol&nbsp;"</span><span>,</span><span style="color: #0000ff;">Symbol</span><span>());</span><br> <span>&nbsp;&nbsp;}</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>See also</span></p> 
<p><span><a href="/basis/types/classes">Structures and Classes</a>, <a href="/convert/timetostring">TimeToString</a>, <a href="/convert/stringformat">StringFormat</a></span></p> 
<br>