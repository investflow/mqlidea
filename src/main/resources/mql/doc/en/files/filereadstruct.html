<h1>FileReadStruct</h1> 
<p><span>The function reads contents into a structure passed as a parameter from a binary-file, starting with the current position of the file pointer.</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span>uint&nbsp;&nbsp;</span><span>FileReadStruct</span><span>(</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_handle</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;file&nbsp;handle</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>const&nbsp;void&amp;</span><span>&nbsp;&nbsp;</span><span>struct_object</span><span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;target&nbsp;structure&nbsp;to&nbsp;which&nbsp;the&nbsp;contents&nbsp;are&nbsp;read</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>size=-1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;structure&nbsp;size&nbsp;in&nbsp;bytes</span><br> <span>&nbsp;&nbsp;&nbsp;);</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>Parameters</span></p> 
<p><span>file_handle</span></p> 
<p><span>[in] File descriptor of an open bin-file.</span></p> 
<p><span>struct_object</span></p> 
<p><span>[out] &nbsp;The object of this structure. The structure should not contain strings, <a href="/basis/types/dynamic_array">dynamic arrays</a> or <a href="/basis/oop/virtual">virtual functions</a>.</span></p> 
<p><span>size=-1</span></p> 
<p><span>[in] &nbsp;Number of bytes that should be read. If size is not specified or the indicated value is greater than the size of the structure, the exact size of the specified structure is used.</span></p> 
<p><span>Return Value</span></p> 
<p><span>If successful the function returns the number of bytes read or 0 in case of error. If successful, the number of bytes read corresponds to the size of the structure. </span><span>To obtain information about the <a href="/constants/errorswarnings/errorcodes">error</a> call the <a href="/check/getlasterror">GetLastError()</a> function. </span><span>File pointer is moved by the same number of bytes.</span></p> 
<p><span style="font-weight: bold;">Example </span><span>(the file obtained after using the example for <a href="/files/filewritestruct">FileWriteStruct()</a> function is used here)</span></p> 
<div style="text-align: left; text-indent: 0px; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0px 0px 0px 0px; margin: 2px 17px 2px 17px;">
 <table cellpadding="3" style="border:none; border-spacing:0px;"> 
  <tbody>
   <tr>
    <td style="vertical-align:top; padding:3px;"><p><span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Demo_FileReadStruct.mq4&nbsp;|</span><br> <span style="color: #808080;">//|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Copyright&nbsp;2014,&nbsp;MetaQuotes&nbsp;Software&nbsp;Corp.&nbsp;|</span><br> <span style="color: #808080;">//|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://www.mql5.com&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">copyright</span><span>&nbsp;</span><span style="color: #008080;">"Copyright&nbsp;2014,&nbsp;MetaQuotes&nbsp;Software&nbsp;Corp."</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">link</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008080;">"https://www.mql5.com"</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">version</span><span>&nbsp;&nbsp;&nbsp;</span><span style="color: #008080;">"1.00"</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">indicator_separate_window</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">indicator_buffers</span><span>&nbsp;4</span><br> <span style="color: #808080;">//----&nbsp;plot&nbsp;Label1</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_label1&nbsp;&nbsp;</span><span style="color: #008080;">"Open"</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_type1&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">DRAW_LINE</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_color1&nbsp;&nbsp;</span><span style="color: #0000ff;">clrBlue</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_style1&nbsp;&nbsp;</span><span style="color: #0000ff;">STYLE_SOLID</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_width1&nbsp;&nbsp;1</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_label1&nbsp;&nbsp;</span><span style="color: #008080;">"High"</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_type2&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">DRAW_LINE</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_color2&nbsp;&nbsp;</span><span style="color: #0000ff;">clrGreen</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_style2&nbsp;&nbsp;</span><span style="color: #0000ff;">STYLE_SOLID</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_width2&nbsp;&nbsp;1</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_label1&nbsp;&nbsp;</span><span style="color: #008080;">"Low"</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_type3&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">DRAW_LINE</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_color3&nbsp;&nbsp;</span><span style="color: #0000ff;">clrOrange</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_style3&nbsp;&nbsp;</span><span style="color: #0000ff;">STYLE_SOLID</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_width3&nbsp;&nbsp;1</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_label1&nbsp;&nbsp;</span><span style="color: #008080;">"Close"</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_type4&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">DRAW_LINE</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_color4&nbsp;&nbsp;</span><span style="color: #0000ff;">clrRed</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_style4&nbsp;&nbsp;</span><span style="color: #0000ff;">STYLE_SOLID</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;indicator_width4&nbsp;&nbsp;1</span><br> <span style="color: #0000ff;">#property</span><span>&nbsp;</span><span style="color: #0000ff;">indicator_separate_window</span><br> <span style="color: #808080;">//---&nbsp;parameters&nbsp;for&nbsp;receiving&nbsp;data</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;&nbsp;InpFileName=</span><span style="color: #008080;">"EURUSD.txt"</span><span>;&nbsp;</span><span style="color: #808080;">//&nbsp;file&nbsp;name</span><br> <span style="color: #0000ff;">input</span><span>&nbsp;</span><span style="color: #0000ff;">string</span><span>&nbsp;&nbsp;InpDirectoryName=</span><span style="color: #008080;">"Data"</span><span>;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;directory&nbsp;name</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Structure&nbsp;for&nbsp;storing&nbsp;candlestick&nbsp;data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">struct</span><span>&nbsp;candlesticks</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">open</span><span>;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;open&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">close</span><span>;&nbsp;</span><span style="color: #808080;">//&nbsp;close&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">high</span><span>;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;high&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">low</span><span>;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;low&nbsp;price</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date;&nbsp;&nbsp;</span><span style="color: #808080;">//&nbsp;date</span><br> <span>&nbsp;&nbsp;};</span><br> <span style="color: #808080;">//---&nbsp;indicator&nbsp;buffers</span><br> <span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open_buff[];</span><br> <span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close_buff[];</span><br> <span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;high_buff[];</span><br> <span style="color: #0000ff;">double</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;low_buff[];</span><br> <span style="color: #808080;">//---&nbsp;global&nbsp;variables</span><br> <span>candlesticks&nbsp;cand_buff[];</span><br> <span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size=0;</span><br> <span style="color: #0000ff;">int</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ind=0;</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Custom&nbsp;indicator&nbsp;initialization&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">int</span><span>&nbsp;</span><span style="color: #0000ff;">OnInit</span><span>()</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;default_size=100;</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(cand_buff,default_size);</span><br> <span style="color: #808080;">//---&nbsp;open&nbsp;the&nbsp;file</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ResetLastError</span><span>();</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;file_handle=</span><span style="color: #0000ff;">FileOpen</span><span>(InpDirectoryName+</span><span style="color: #008080;">"//"</span><span>+InpFileName,</span><span style="color: #0000ff;">FILE_READ</span><span>|</span><span style="color: #0000ff;">FILE_BIN</span><span>|</span><span style="color: #0000ff;">FILE_COMMON</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(file_handle!=</span><span style="color: #0000ff;">INVALID_HANDLE</span><span>)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">PrintFormat</span><span>(</span><span style="color: #008080;">"%s&nbsp;file&nbsp;is&nbsp;available&nbsp;for&nbsp;reading"</span><span>,InpFileName);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">PrintFormat</span><span>(</span><span style="color: #008080;">"File&nbsp;path:&nbsp;%s\\Files\\"</span><span>,</span><span style="color: #0000ff;">TerminalInfoString</span><span>(</span><span style="color: #0000ff;">TERMINAL_COMMONDATA_PATH</span><span>));</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;read&nbsp;data&nbsp;from&nbsp;the&nbsp;file</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">while</span><span>(!</span><span style="color: #0000ff;">FileIsEnding</span><span>(file_handle))</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;write&nbsp;data&nbsp;to&nbsp;the&nbsp;array</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">uint</span><span>&nbsp;bytesread=</span><span style="color: #0000ff;">FileReadStruct</span><span>(file_handle,cand_buff[size]);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;check&nbsp;data&nbsp;read</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>&nbsp;(bytesread!=</span><span style="color: #0000ff;">sizeof</span><span>(candlesticks))</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">PrintFormat</span><span>(</span><span style="color: #008080;">"Error&nbsp;reading&nbsp;data.&nbsp;Error&nbsp;code=%d"</span><span>,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;close&nbsp;the&nbsp;file</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">FileClose</span><span>(file_handle);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">INIT_FAILED</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">else</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size++;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;check&nbsp;if&nbsp;the&nbsp;array&nbsp;is&nbsp;overflown</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(size==default_size)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;increase&nbsp;the&nbsp;array&nbsp;size</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_size+=100;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArrayResize</span><span>(cand_buff,default_size);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;close&nbsp;the&nbsp;file</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">FileClose</span><span>(file_handle);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">PrintFormat</span><span>(</span><span style="color: #008080;">"Data&nbsp;is&nbsp;read,&nbsp;%s&nbsp;file&nbsp;is&nbsp;closed"</span><span>,InpFileName);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">else</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">PrintFormat</span><span>(</span><span style="color: #008080;">"Failed&nbsp;to&nbsp;open&nbsp;%s&nbsp;file,&nbsp;Error&nbsp;code&nbsp;=&nbsp;%d"</span><span>,InpFileName,</span><span style="color: #0000ff;">GetLastError</span><span>());</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">INIT_FAILED</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;indicator&nbsp;buffers&nbsp;mapping</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">SetIndexBuffer</span><span>(0,open_buff,</span><span style="color: #0000ff;">INDICATOR_DATA</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">SetIndexBuffer</span><span>(1,high_buff,</span><span style="color: #0000ff;">INDICATOR_DATA</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">SetIndexBuffer</span><span>(2,low_buff,</span><span style="color: #0000ff;">INDICATOR_DATA</span><span>);</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">SetIndexBuffer</span><span>(3,close_buff,</span><span style="color: #0000ff;">INDICATOR_DATA</span><span>);</span><br> <span style="color: #808080;">//---&nbsp;empty&nbsp;value</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">PlotIndexSetDouble</span><span>(0,</span><span style="color: #0000ff;">PLOT_EMPTY_VALUE</span><span>,0);</span><br> <span style="color: #808080;">//---</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(</span><span style="color: #0000ff;">INIT_SUCCEEDED</span><span>);</span><br> <span>&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #808080;">//|&nbsp;Custom&nbsp;indicator&nbsp;iteration&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br> <span style="color: #808080;">//+------------------------------------------------------------------+</span><br> <span style="color: #0000ff;">int</span><span>&nbsp;</span><span style="color: #0000ff;">OnCalculate</span><span>(</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;rates_total,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;prev_calculated,</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">datetime</span><span>&nbsp;&amp;</span><span style="color: #0000ff;">time</span><span>[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&amp;</span><span style="color: #0000ff;">open</span><span>[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&amp;</span><span style="color: #0000ff;">high</span><span>[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&amp;</span><span style="color: #0000ff;">low</span><span>[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">double</span><span>&nbsp;&amp;</span><span style="color: #0000ff;">close</span><span>[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">long</span><span>&nbsp;&amp;tick_volume[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">long</span><span>&nbsp;&amp;</span><span style="color: #0000ff;">volume</span><span>[],</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">const</span><span>&nbsp;</span><span style="color: #0000ff;">int</span><span>&nbsp;&amp;spread[])</span><br> <span>&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">ArraySetAsSeries</span><span>(</span><span style="color: #0000ff;">time</span><span>,</span><span style="color: #0000ff;">false</span><span>);</span><br> <span style="color: #808080;">//---&nbsp;the&nbsp;loop&nbsp;for&nbsp;the&nbsp;candlesticks&nbsp;that&nbsp;have&nbsp;not&nbsp;been&nbsp;handled&nbsp;yet</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;i=prev_calculated;i&lt;rates_total;i++)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;0&nbsp;by&nbsp;default</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open_buff[i]=0;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close_buff[i]=0;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;high_buff[i]=0;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;low_buff[i]=0;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;check&nbsp;if&nbsp;any&nbsp;data&nbsp;is&nbsp;still&nbsp;present</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(ind&lt;size)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span>(</span><span style="color: #0000ff;">int</span><span>&nbsp;j=ind;j&lt;size;j++)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;if&nbsp;dates&nbsp;coincide,&nbsp;the&nbsp;value&nbsp;from&nbsp;the&nbsp;file&nbsp;is&nbsp;used</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span>(</span><span style="color: #0000ff;">time</span><span>[i]==cand_buff[j].date)</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open_buff[i]=cand_buff[j].</span><span style="color: #0000ff;">open</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close_buff[i]=cand_buff[j].</span><span style="color: #0000ff;">close</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;high_buff[i]=cand_buff[j].</span><span style="color: #0000ff;">high</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;low_buff[i]=cand_buff[j].</span><span style="color: #0000ff;">low</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">//---&nbsp;increase&nbsp;the&nbsp;counter</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ind=j+1;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">break</span><span>;</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br> <span style="color: #808080;">//---&nbsp;return&nbsp;value&nbsp;of&nbsp;prev_calculated&nbsp;for&nbsp;next&nbsp;call</span><br> <span>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span>(rates_total);</span><br> <span>&nbsp;&nbsp;}</span></p></td> 
   </tr> 
  </tbody>
 </table> 
</div> 
<p><span>See also</span></p> 
<p><span><a href="/basis/types/classes">Structures and classes</a>, </span><span><a href="/files/filewritestruct">FileWriteStruct()</a></span></p> 
<br>